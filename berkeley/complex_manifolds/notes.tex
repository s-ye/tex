\documentclass[12pt]{article}
\usepackage[english]{babel}
\usepackage[utf8x]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{listings}
\usepackage{bookmark}
\usepackage{tikz}
\usepackage{/Users/songye03/Desktop/math_tex/style/quiver}
\usepackage{/Users/songye03/Desktop/math_tex/style/scribe}
\usepackage{fancyhdr}

\usepackage{parskip} % Automatically respects blank lines
\setlength{\parskip}{1em} % Adds more space between paragraphs
\setlength{\parindent}{0pt} % Removes paragraph indentation

\begin{document}


\lhead{Songyu Ye}
\rhead{\today}
\cfoot{\thepage}

\title{Complex Manifolds}

\author{Songyu Ye}
\date{\today}
\maketitle


\begin{abstract}
    These are notes for the course Complex Manifolds (Math 241) taught by Professor Constantin Teleman in the Fall of 2025 at UC Berkeley.
\end{abstract}

\tableofcontents
\section{Elliptic functions}
The classical story begins with the Weierstrass $\wp$-function, defined by
\[\wp(z;L) = \frac{1}{z^2} + \sum_{\omega \in L\setminus\{0\}} \left(\frac{1}{(z-\omega)^2} - \frac{1}{\omega^2}\right)\]
which has the properties that it is an $L$-periodic meromorphic function on $\C$ with double poles at the lattice points, and that it satisfies the differential equation
\[(\wp'(z))^2 = 4\wp(z)^3 - g_2\wp(z) - g_3 = 4(z - e_1)(z - e_2)(z - e_3)\]
where $g_2,g_3$ are constants depending on $L$, given explicitly by \begin{align*}
    g_2 & = 60\sum_{\omega \in L\setminus\{0\}} \frac{1}{\omega^4} \\
    g_3 & = 140\sum_{\omega \in L\setminus\{0\}} \frac{1}{\omega^6}
\end{align*} and $e_i$ are the values of $\wp$ at the half-lattice points $\omega_1/2, \omega_2/2, (\omega_1+\omega_2)/2$. The $e_i$ are distinct as we will show in Prop \ref{prop:wp-map}.
The convergence is uniform on any compact subset $K \subset \C$, once the terms with poles in $K$ are set aside.

Uniform convergence implies that the series can be differentiated term-by-term, so we get a formula for $\wp'(z)$ given by \begin{align*}
    \wp'(z) & = -2\sum_{\omega \in L} \frac{1}{(z-\omega)^3}
\end{align*} is an doubly periodic meromorphic function with triple poles at the lattice points. Moreover, one can see directly from the series expansion that $\wp$ is even and $\wp'$ is odd.

The oddness implies that $\wp'(z)$ vanishes at the half-lattice points. Moreover, one can check that these are simple zeros of $\wp'$, and moreover the only zeros of $\wp'$ modulo $L$. Thus $\wp'$ has only poles at lattice points, each of order 3. In a fundamental parallelogram there is exactly one pole (mod $L$), of total multiplicity 3. This implies the following proposition.
\begin{proposition}
    $\wp(z)$ and $\wp'(z)$ define holomorphic maps $\C/L \to \P^1$ of degree $2$ and $3$ respectively.
\end{proposition}
We conclude that each of the half-lattice points must be a simple zero of $\wp'$ and moreover that these are all of the zeros, because any meromorphic function has divisor of degree 0.

\begin{proposition}[Properties of the $\wp$-map]\label{prop:wp-map}
\leavevmode
\begin{enumerate}[(i)]
    \item The numbers $e_1,e_2,e_3$ are all distinct.
    \item For any $a \in \mathbb{C}$ with $a \neq e_1,e_2,e_3$, the equation $\wp(u)=a$ has two simple roots in a fundamental period parallelogram. For the three exceptional values $a=e_i$, it has a single double root.
\end{enumerate}
\end{proposition}

\begin{proof}
\leavevmode
\begin{enumerate}[(i)]
    \setcounter{enumi}{1}
    \item General theory of meromorphic functions on a torus shows that we either have two simple roots or one double root. Since a double root corresponds to a zero of the derivative $\wp'$, the claim follows. Note that the two simple roots always differ by a sign modulo $L$, by the parity of $\wp$.
    
    \setcounter{enumi}{0}
    \item Suppose, for contradiction, that $e_1=e_2$. Then $\wp(u)=e_1$ would have a double root at $\tfrac{\omega_1}{2}$ and another double root at $\tfrac{\omega_2}{2}$. This would give too many roots (multiplicity $4$ in a fundamental parallelogram), contradicting the fact that $\wp$ is a double covering of $\mathbb{P}^1$. Hence the $e_i$ are distinct.
\end{enumerate}
\end{proof}
\begin{remark}
    Kac writes that this quadratic term which appears in the definition of $t_\alpha$ \ref{eq:ta} "explains" the appearance of theta functions in the theory of affine algebras. This is because when you compute the characters of highest-weight representations of affine Kac-Moody algebras, you sum over the affine Weyl group:
\[\chi(\lambda) = \sum_{w \in W} \det(w)\, e^{w(\lambda+\rho) - \rho}\]
and theta functions arise precisely when you sum exponentials of the form \begin{align*}
    \Theta(\tau, z) = \sum_{\alpha \in \text{lattice}} \exp\!\big(-\tfrac{1}{2}|\alpha|^2 \tau + \langle \alpha, z\rangle\big).
\end{align*}
Continuing with the discussion of theta functions, we have the following theorem about genus $1$ Riemann surfaces.
\end{remark}

\begin{theorem}
    Let $\theta_1,\dots,\theta_4$ be the four Jacobi theta functions. Then there is a map \begin{align*}
        E/L \to \mathbb{CP}^3, \quad z \mapsto [\theta_1(z,\tau):\theta_2(z,\tau):\theta_3(z,\tau):\theta_4(z,\tau)]
    \end{align*} which is a smooth embedding of the complex torus $E=\mathbb{C}/L$ into projective space. It is a degree $4$ map and its image is the intersection of two quadrics.
\end{theorem}

\begin{proposition}
The function $\wp : \mathbb{C}/L \to \mathbb{P}^1$ is a degree $2$ holomorphic map with branch points over 
$e_1, e_2, e_3, \infty$.
\end{proposition}

Those of us who solved Example Sheet 1, Question 2, have seen the same picture of branching 
for the Riemann surface of the cubic equation
\[
    w^2 = (z - e_1)(z - e_2)(z - e_3);
\]
in Lecture 10, we shall establish a deep connection between the two.

We will use the $\wp$-function to prove the Unique Presentation by principal parts.
Uniqueness being clear on general grounds (cf.\ Lecture 4), we merely need to prove the existence statement;
and this will emerge from the proof of the first theorem below. 
Remarkably, this will also allow us to describe the field of meromorphic functions over $\mathbb{C}/L$.

\begin{theorem}
Every elliptic function is a rational function of $\wp$ and $\wp'$. 
Specifically, every \textbf{even} elliptic function is a rational function of $\wp$, 
every \textbf{odd} elliptic function is $\wp'$ times a rational function of $\wp$;
and every elliptic function can be expressed uniquely as
\[
    f(u) = R_0(\wp(u)) + \wp'(u)\, R_1(\wp(u)),
\]
with $R_0, R_1$ rational functions, where the two terms are the even and odd parts of $f$.
\end{theorem}

\begin{proof}
It suffices to prove the statement for even elliptic functions; division by $\wp'$ reduces odd ones to even ones. 
Recall that 
\[
\wp : \C/L \longrightarrow \P^1
\]
is a degree $2$ holomorphic map. 
This map realizes $\P^1$ as the quotient space of the torus $\C/L$ under the identification of $u$ with $-u$. Certainly the map is surjective because general theory of holomorphic maps between compact Riemann surfaces shows that any nonconstant holomorphic map is surjective. The map is injective because $\wp(u) = \wp(v)$ if and only if $u \equiv \pm v \mod L$. 

A bijective holomorphic map between compact Riemann surfaces is automatically biholomorphic.
Let $f:R \to S$ be such a map. The inverse function theorem guarantees that the inverse function $f^{-1}$ is smooth. Moreover, it guarantees that
    \begin{align*}
        (f^{-1})'(b) = \frac{1}{f'(f^{-1}(b))}
    \end{align*}
    Since $f$ is bijective, it has nonzero derivative everywhere because if it did not, it would look like $z\mapsto z^k$ for some $k\geq 2$ and thus it would fail to be locally bijective. Since it has nonzero derivative everywhere, $(f^{-1})'$ is defined everywhere and is in fact a complex number. Hence $f^{-1}$ is holomorphic. $\Delta$ and $\mathbb{C}$ are homeomorphic but they are not biholomorphic. 

So indeed $\P^1$ is the quotient of $\C/L$ by the involution $u \mapsto -u$. Hence, any even \textbf{continuous} map 
\[
f : \C/L \to \P^1
\]
has the form $f = R \circ \wp$, for some continuous map $R : \P^1 \to \P^1$. 
Moreover, $\wp$ is a local analytic isomorphism away from the four branch points, which implies that $R$ is holomorphic there, if $R \circ \wp$ was so. So we know that $R$ is continuous everywhere and holomorphic away from the four branch points. 

The following result shows that $R$ is holomorphic everywhere, hence a rational function. \begin{align*}
    R(z) = P(z)/Q(z) \implies f(u) = P(\wp(u))/Q(\wp(u))
\end{align*} Writing every elliptic function as a sum of an even and an odd one, and the odd ones as $\wp'$ times an even one, we get the desired result.
\end{proof}

\begin{proposition}
Let $f : S \to R$ be a continuous map between Riemann surfaces, known to be holomorphic except at isolated points. 
Then $f$ is holomorphic everywhere.
\end{proposition}

\begin{proof}
Choosing coordinate neighbourhoods near the questionable points and their images, we are reduced to the statement that a continuous function on $\Delta$ which is holomorphic on $\Delta^\times$ is, in fact, holomorphic at $0$ as well. This follows from Riemann's theorem on removable singularities.
\end{proof}

A remarkable consequence is that the function $\wp'(u)^2$, being elliptic and even, 
is expressible in terms of $\wp$. Explicitly, we have the following.

\begin{theorem}[Differential equation for $\wp$]
\[
    \wp'(u)^2 = 4\wp(u)^3 - g_2 \wp(u) - g_3,
\]
where $g_2 = 60G_4$, $g_3 = 140G_6$, and
\[
    G_r = G_r(L) = \sum_{\omega \in L^*} \omega^{-r}.
\]
\end{theorem}

\begin{proof}
Recall the Laurent expansion of the Weierstrass function
\[
\wp(u)=u^{-2}+3G_4(L)u^{2}+5G_6(L)u^{4}+\cdots,
\qquad
\wp'(u)=-2u^{-3}+6G_4(L)u+20G_6(L)u^{3}+\cdots .
\]

For $|u|<|\omega|$ and any integer $k\ge1$,
\[
(u-\omega)^{-k}
=\frac{(-1)^k}{\omega^{k}}
\Bigg[\,1+k\frac{u}{\omega}+\frac{k(k+1)}{2!}\frac{u^{2}}{\omega^{2}}
+\frac{k(k+1)(k+2)}{3!}\frac{u^{3}}{\omega^{3}}+\cdots\Bigg].
\]
Expanding each term in the defining series for $\wp$ with the above, and (for small $u$) interchanging sums, the odd powers in $u$ cancel, giving
\[
\wp(u)=u^{-2}+\sum_{m=1}^{\infty}\binom{-2}{2m}\,G_{2m+2}(L)\,u^{2m}
= u^{-2}+\sum_{m=1}^{\infty}(2m+1)\,G_{2m+2}(L)\,u^{2m}.
\]
Similarly,
\[
\wp'(u)=-2u^{-3}
+\sum_{m=0}^{\infty}\big(-2\big)\binom{-3}{\,2m+1\,}\,G_{2m+4}(L)\,u^{2m+1}
\]

Using these expansions, the first few terms of $(\wp'(u))^{2}$ and
$4\wp(u)^{3}-g_{2}\wp(u)-g_{3}$ agree at $u=0$; hence their difference is an elliptic function
with no poles that vanishes at $u=0$, so it is identically zero. 
\end{proof}

The two theorems immediately lead to a description of the field of meromorphic functions on $\mathbb{C}/L$.

\begin{corollary}
The field of meromorphic functions on $\mathbb{C}/L$ is isomorphic to
\[
    \mathbb{C}(z)[w] \big/ (w^2 - 4z^3 + g_2 z + g_3),
\]
the degree $2$ extension of the field of rational functions $\mathbb{C}(z)$ obtained by adjoining the solutions 
$w$ to the equation 
\[
    w^2 = 4z^3 - g_2 z - g_3.
\]
\end{corollary}

\begin{theorem}
Let $z_1, \dots, z_n$ and $p_1, \dots, p_m$ denote the zeroes and poles of a non-constant elliptic function $f$ in the period parallelogram, repeated according to multiplicity. Then:
\begin{enumerate}[(i)]
    \item $m = n$,
    \item $\displaystyle \sum_{k=1}^m \operatorname{Res}_{p_k}(f) = 0,$
    \item $\displaystyle \sum_{k=1}^n z_k = \sum_{k=1}^m p_k \pmod{L}.$
\end{enumerate}
\end{theorem}

\begin{proof}
    (i) follows from the fact that
    \[\frac{1}{2\pi i}\int_{\partial P} \frac{f’(z)}{f(z)}\,dz = n - m\] where $P$ is the period parallelogram. The integral is zero because opposite sides cancel out due to periodicity of $f$.
    (ii) follows from the fact that
    \[\sum_k \operatorname{Res}_{p_k}(f) = \frac{1}{2\pi i} \int_{\partial P} f(z)\,dz\] and the integral is zero by periodicity.

Let's integrate $z\frac{f'(z)}{f(z)}$ over the boundary $\partial P$:
\[
I = \int_{\partial P} z\frac{f'(z)}{f(z)}\,dz
\]

By the residue theorem:
\[
I = 2\pi i\sum_{k} \operatorname{Res}_{z=z_k}(z f'/f) + 2\pi i\sum_{k} \operatorname{Res}_{z=p_k}(z f'/f)
\]

At a zero $z_k$ of order $r$, we have $\frac{f'(z)}{f(z)} \sim \frac{r}{z-z_k}$, so $\operatorname{Res}_{z_k}(z f'/f) = r z_k$. At a pole $p_k$ of order $s$, we have $\frac{f'(z)}{f(z)} \sim -\frac{s}{z-p_k}$, so $\operatorname{Res}_{p_k}(z f'/f) = -s p_k$. Hence
\[
\frac{I}{2\pi i} = \sum_{k=1}^n r_k z_k - \sum_{k=1}^m s_k p_k = \sum z_k - \sum p_k
\]
using multiplicities.

Now consider how $z f'/f$ behaves under translation by a period $\omega$. When you shift $z \mapsto z+\omega_i$, $f'/f$ stays the same (because it's periodic), but $z$ changes by $+\omega_i$.

When traversing the parallelogram boundary, the two vertical sides differ by the period $\omega_1$, and the two horizontal sides differ by $\omega_2$. Careful calculation gives:
\[
I = 2\pi i\,(\omega_1 k_1 + \omega_2 k_2)
\]
for some integers $k_1,k_2$, because the integral around the boundary shifts by integer multiples of the lattice periods (this is the quasi-periodicity of the logarithm of $f$).

Thus
\[
\sum z_k - \sum p_k \equiv 0 \pmod{L}
\]
as desired.
\end{proof}

\begin{remark}
    Let $\omega$ be a meromorphic differential on a compact Riemann surface $S$. Then the sum of its residues at all poles is zero. Let $p_i$ be the poles of $\omega$ and take disks $D_i$ around each $p_i$. Then the boundary of $S \setminus \cup D_i$ is $\sum \partial D_i$. By Stokes' theorem,
    \[
    \int_{S \setminus \cup D_i} d\omega = \int_{\partial (S \setminus \cup D_i)} \omega = \sum_i \int_{\partial D_i} \omega
    \] The left side is zero because $d\omega=0$ (since $\omega$ is a holomorphic $1$-form). The right hand side is $2\pi i \sum \operatorname{Res}_{p_i}(\omega)$. Hence the sum of residues is zero.
\end{remark}
Hartshorne actually delays the proof of the residue theorem until he has developed sheaf cohomology, because the general proof uses Serre duality. In the analytic setting, the proof is more elementary, as above.

\begin{definition}
    Fix a local coordinate $z$ at a point $p$. The \textbf{principal part} of a meromorphic function $f$ at $p$ is the part of its Laurent expansion in negative powers of $(z-p)$:
\[\sum_{n=1}^N a_{-n}(z-p)^{-n}\]
\end{definition}


\begin{theorem}[Unique Presentation by principal parts]
An elliptic function is specified uniquely, up to an additive constant, 
by prescribing its principal parts at all poles in the period parallelogram. 
The prescription is subject only to condition~(ii).
\end{theorem}

\begin{proof}
This is more computational, but also more concrete. 
We first show that we can realize any even assignment of principal parts on $\C/L$ using a suitable rational function $R(\wp(u))$. 
Such an assignment involves finitely many points $\lambda \in \C/L$ and principal parts
\[
    \sum_{k=1}^{n_\lambda} a^{(\lambda)}_k (u - \lambda)^{-k},
\]
with the properties that:
\begin{itemize}
    \item if $2\lambda \notin L$, then $(-\lambda)$ also appears, with assignment
    \[
        \sum_{k=1}^{n_\lambda} (-1)^k a^{(\lambda)}_k (u + \lambda)^{-k},
    \]
    i.e.\ $a_k^{(-\lambda)} = (-1)^k a_k^{(\lambda)}$;
    \item if $2\lambda \in L$, then only even powers of $(u - \lambda)^{-1}$ are present.
\end{itemize}

This is because the local coordinates at $\lambda$ and $-\lambda$ are opposite signs. Write the principal part at $\lambda$ (using $v=u-\lambda$): $f(u)=\sum_{k=1}^{n_\lambda} a_k^{(\lambda)}\,v^{-k}+\cdots$. Near $-\lambda$ use $w=u+\lambda$. Evenness gives \[f(-\lambda+w)=f\bigl(-(-\lambda+w)\bigr)=f(\lambda-w) =\sum_{k\ge1} a_k^{(\lambda)}(-w)^{-k} =\sum_{k\ge1} (-1)^k a_k^{(\lambda)}\,w^{-k}\]
If $2\lambda\in L$ (so $-\lambda\equiv\lambda$ on $\C/L$), the same calculation forces $\sum_{k\ge1} a_k^{(\lambda)} v^{-k}=\sum_{k\ge1} a_k^{(\lambda)}(-v)^{-k}$, hence $a_k^{(\lambda)}=0$ for all odd $k$: only even powers $(u-\lambda)^{-2j}$ can appear.

Now if $2\lambda \notin L$, $(\wp(u) - \wp(\lambda))^{-1}$ has a simple pole at $u=\lambda$ and we can create any principal part there as a sum of $(\wp(u) - \wp(\lambda))^{-k}$. 
Evenness of $\wp$ takes care of the symmetry. 
If $2\lambda \in L$, then we can use either powers of $\wp$, if $\lambda \in L$, or powers of $(\wp(u) - e_{1,2,3})^{-1}$, which have double poles with no residue.

Now, onto the odd functions. 
Odd assignments of principal parts are of the form
\[
    \sum_{k=1}^{n_\lambda} a^{(\lambda)}_k (u - \lambda)^{-k},
\]
with a matching term
\[
    -\sum_{k=1}^{n_\lambda} (-1)^k a^{(\lambda)}_k (u + \lambda)^{-k}
\]
at $-\lambda$ (i.e.\ $a^{(-\lambda)}_k = (-1)^{k+1} a^{(\lambda)}_k$), 
or else with vanishing $a^{(\lambda)}_k$ (for even $k$) if $2\lambda \in L$.

The principal parts
\[
    \left( \frac{P_\lambda}{\wp'(u)} - \frac{P_{-\lambda}}{\wp'(u)} \right)
\]
can be realized by a sum of powers of $(\wp(u) - \wp(\lambda))^{-1}$. 
If $2\lambda \in L$ but $\lambda \notin L$ (not $0$), then $P_\lambda^{(u)}/\wp'(u)$ is also a well-defined even principal part, expressible via $(\wp(u) - \wp(\lambda))^{-1}$. 
The same goes for $P_0^{(u)}/\wp'(u)$. 
So there exists a function of the form $R_1(\wp(u))$ whose principal parts agree with the $P_\lambda(u)/\wp'(u)$ everywhere. 

The principal parts of $R_1(\wp(u))\,\wp'(u)$ agree with the $P_\lambda$, except possibly at $\lambda=0$, where the cubic pole of $\wp'$ could introduce unwanted or incorrect $u^{-3}$ and $u^{-1}$ terms. 
We can adjust the $u^{-3}$ term by shifting $R_1$ by a constant. 
We have no control over the $u^{-1}$ term, but that is determined from the condition $\sum \operatorname{Res} = 0$, 
which indeed must be met if a function with the prescribed principal parts is to exist.
\end{proof}

\begin{theorem}[Unique Presentation by zeroes and poles]
An elliptic function is specified uniquely, up to a multiplicative constant, 
by prescribing the location of its zeroes and poles in the period parallelogram, with multiplicities. 
The prescription is subject to conditions~(i) and~(iii).
\end{theorem}


\begin{lemma}
$g_2^3 \neq 27g_3^2$ and $e_1, e_2, e_3$ are the roots of the equation
\[
4z^3 - g_2 z - g_3 = 0.
\]
\end{lemma}

\begin{proof}
$\wp'$ vanishes at the half-lattice points, while $\wp$ takes the values $e_1,e_2,e_3$ there. The roots are distinct so the discriminant of the cubic is nonzero, i.e.\ $g_2^3 \neq 27g_3^2$.
\end{proof}

\begin{theorem}[Geometric interpretation]
The map $\C/L \setminus \{0\} \to \C^2$ given by
\[
u \longmapsto (z(u), w(u)) = (\wp(u), \wp'(u))
\]
gives an analytic isomorphism between the Riemann surface $\C/L \setminus \{0\}$ and the (concrete) Riemann surface $R$ of the function
\[
w^2 = 4z^3 - g_2 z - g_3
\]
in $\C^2$.
\end{theorem}

\begin{proof}
We have the commutative diagram:
\[
\begin{tikzcd}
\C/L \setminus \{0\} \arrow[r, "{(\wp,\wp')}"] \arrow[dr, "{\wp}"'] & R \arrow[d, "{\pi}"] \\
 & \C
\end{tikzcd}
\]
and we know that:
\begin{itemize}
    \item $\pi$ is proper and $2$-to-$1$ except at the branch points $e_1,e_2,e_3$, which are the roots of $4z^3 - g_2z - g_3$.
    \item $\wp$ is proper and $2$-to-$1$ except at the half-period points $\omega_1/2,\omega_2/2,\omega_1/2+\omega_2/2$, which map to the roots $e_1,e_2,e_3$.
    \item $\wp(u)=\wp(-u)$ and $\wp'(u)=-\wp'(-u)$: this means that, unless $u$ is a half-period, $\wp'$ takes both values $\pm w = \pm \wp'(u)$ at the two points $\pm u$ mapping to the same $z=\wp(u)$ of $\C$.
\end{itemize}

Together, these three properties show that the map we just constructed is bijective. 
Note further that, at no point $u \in \C/L \setminus \{0\}$, is $\wp'(u)=\wp''(u)=0$, because $\wp'$ has simple zeros only (there are three of them); 
this means that for every $u \in \C/L \setminus \{0\}$, either the map $\wp$ or the map $\wp'$ gives an analytic isomorphism of a neighbourhood of $u$ with a small disc in the $z$-plane or in the $w$-plane.

Since the Riemann surface structure on the (concrete, non-singular) Riemann surface $R$ is defined by the projections to the $z$- and $w$-planes, appropriately, we conclude that $(\wp, \wp')$ gives an analytic isomorphism
\[
\C/L \;\longrightarrow\; R.
\]
\end{proof}





\section{Riemann surfaces and field extensions}
\begin{theorem}
The following categories are equivalent:
\begin{itemize}
    \item Compact Riemann surfaces with nonconstant holomorphic maps
    \item Smooth proper (and hence projective) algebraic curves over $\mathbb{C}$ with nonconstant morphisms
    \item Field extensions of $\mathbb{C}$ of transcendence degree $1$, of finite degree over $\mathbb{C}(t)$ where $t$ is transcendental over $\mathbb{C}$, with field homomorphisms over $\mathbb{C}$
\end{itemize}

The correspondence in one direction is:
\begin{align*}
    \text{Riemann surface } S &\mapsto \text{ function field } \mathbb{C}(S) \\
    \text{Holomorphic map } f: S \to S' &\mapsto \text{ field homomorphism } f^*: \mathbb{C}(S') \to \mathbb{C}(S) \\
\end{align*}
\end{theorem}

\begin{remark}
    For curves, smooth and proper implies projective. This is false in higher dimensions.
\end{remark}
Common to both is the construction of nonconstant meromorphic functions. It suffices to find \begin{itemize}
    \item A map $f:R \to \P^1$ which realizes $R$ as a branched cover of $\P^1$ (the transcendental part of the function field) \begin{align*}
        f^*: \mathbb{C}(z) &\hookrightarrow \mathbb{C}(R) \\
        z &\mapsto f
    \end{align*}
    \item A nonconstant meromorphic function $g$ on $S$ which separates the sheets (the finite part of the function field)
\end{itemize}
Once you have these functions, consider the set of pairs $\{(f(p), g(p)) : p \in S\} \subset \mathbb{P}^1 \times \mathbb{P}^1$. This is an analytic curve. By a theorem of Riemann (or later by Chow's theorem), an analytic curve in projective space is algebraic. So there exists a nonzero polynomial $P(x,y)$ such that
\[
P(f,g) = 0 \quad \text{on } S.
\]
Thus, the image of $S$ under $(f,g)$ is contained in the algebraic curve $P(x,y)=0$. Moreover, because $g$ separates the sheets, $(f,g)$ is generically injective, so the map is birational. Hence $S$ and the curve $P(x,y)=0$ have the same function field. So you've now explicitly realized $\mathbb{C}(S) = \mathbb{C}(f,g)$.

We state Riemann's theorem which allows us to pass from the analytic setting to the algebraic setting.
\begin{theorem}
    Let $R$ be a compact Riemann surface and $p\in R$. There exists a meromorphic function $f$ with poles of arbitrary order $n$ at $p$ and holomorphic elsewhere, provided that $n$ is sufficiently large.
\end{theorem}

The method of proof involves constructing holomorphic differentials with poles at $p$, and in fact one can get them to any order of pole $\geq 2$. Then if these differentials are exact, their integrals give a single valued function with pole only at $p$.
\section{Galois theory of compact Riemann surfaces}

The fundamental result of the theory, conjectured by Riemann circa 1850, and proved over the next few decades, is:

\begin{theorem}
Every compact Riemann surface is algebraic.
\end{theorem}

We have an idea what this means, because we have considered Riemann surfaces defined by polynomial equations
\[
P(z,w) = w^n + a_{n-1}(z)w^{n-1} + \cdots + a_1(z)w + a_0(z) = 0,
\]
and we have seen how to compactify these; and indeed, the result does imply that every compact Riemann surface arises in such manner.  
But we would like now to do more than just explain the meaning of the theorem, and survey the basic algebraic tools available for the study of compact Riemann surfaces.

The truly hard part of the theorem is to get started.  Nothing in the definition of an abstract Riemann surface implies in any obvious way the existence of the basic algebraic objects of study, the meromorphic functions.

\begin{theorem}
Every compact Riemann surface carries a non-constant meromorphic function.
\end{theorem}

Equivalently, every compact Riemann surface can be made into a branched cover of $\mathbb{P}^1$.

\medskip
\noindent
\textbf{Remarks.}  
This is the difficult part of the theorem; once we have a branched cover of $\mathbb{P}^1$, we can start studying it by algebraic methods.  
The proof involves serious analysis, specifically finding solutions of the Laplace equation in various surface domains, with prescribed singularities (“Green’s functions”).

\medskip
Contained in Riemann’s theorem, there is a second result which we shall use without proof.

\begin{proposition}
Let $\pi : R \to \mathbb{P}^1$ be a holomorphic map of degree $n > 0$.  
There exists, then, an additional meromorphic function $f$ on $R$ which \textbf{separates the sheets of $R$ over $\mathbb{P}^1$}, in the following sense: there exists a point $z_0 \in \mathbb{P}^1$ such that $f$ takes $n$ distinct values at the points of $R$ over $z_0$.
\end{proposition}

\begin{exercise}
Show that such an $f$ must then take $n$ distinct values over all but finitely many points of $\mathbb{P}^1$.  
(Consider a limit point of a sequence $z_k$ over which $f$ takes fewer values and use the fact that the zeros of a non-constant analytic function are isolated.  
The case when the limit point is a branch point will require extra care.)
\end{exercise}

Assuming now that the Riemann surface $R$ is connected, let $\mathbb{C}(R)$ be its field of meromorphic functions.  
A non-constant meromorphic function $z$ defines an inclusion of fields
\[
\mathbb{C}(z) \subset \mathbb{C}(R).
\]

In algebra, this is commonly called a \textbf{field extension} rather than a “field inclusion.”  
The degree of the field extension, denoted $[\mathbb{C}(R):\mathbb{C}(z)]$, is the dimension of $\mathbb{C}(R)$ as a vector space over $\mathbb{C}(z)$.


\begin{theorem}
    Let $\pi : R \to \mathbb{P}^1$ denote the holomorphic map associated to the meromorphic function $z$.
\begin{enumerate}
    \item $[\mathbb{C}(R):\mathbb{C}(z)] = \deg \pi \;(= n)$.
    \item Any $f \in \mathbb{C}(R)$ satisfies a polynomial equation of degree $\le n$ with coefficients in $\mathbb{C}(z)$:
    \[
    f^n + a_{n-1}(z)f^{n-1} + \cdots + a_0(z) = 0.
    \]
    \item Let $f$ be a meromorphic function on $R$ which separates the sheets of $R$ over $\mathbb{P}^1$.  
    Then $\mathbb{C}(R)$ is generated by $f$ over $\mathbb{C}(z)$:
    \[
    \mathbb{C}(R) = \mathbb{C}(z)[f].
    \]
    \item Let now $f^n + a_{n-1}(z)f^{n-1} + \cdots + a_0(z) = 0$ be the equation satisfied by the $f$ in (iii).  
    Then $R$ is isomorphic to the non-singular, compactified Riemann surface of the equation
    \[
    w^n + a_{n-1}(z)w^{n-1} + \cdots + a_1(z)w + a_0(z) = 0.
    \]
\end{enumerate}
\end{theorem}

\begin{theorem}
There is a bijection between isomorphism classes of field extensions of $\mathbb{C}(z)$ on one hand, and isomorphism classes of compact Riemann surfaces, together with a degree $n$ map to $\mathbb{P}^1$.
\end{theorem}

Forgetting the map to $\mathbb{P}^1$, we have:

\begin{theorem}
There is a bijection between isomorphism classes of fields which can be realized as finite extensions of $\mathbb{C}(z)$, on one hand, and isomorphism classes of compact Riemann surfaces, on the other.
\end{theorem}

The theorem follows essentially from part~(iv) of the previous result; the only missing ingredient, which rounds up the correspondence between Riemann surfaces and their fields of functions, is:

\begin{theorem}
Homomorphisms from $\mathbb{C}(S)$ to $\mathbb{C}(R)$ are in bijection with holomorphic maps from $R$ to $S$.
\end{theorem}

\noindent
Recall that a finite field extension $k \subset K$ is called \textbf{Galois}, with group $\Gamma$, if $\Gamma$ acts by automorphisms of $K$ and $k$ is precisely the set of elements fixed by $\Gamma$.

\begin{proposition}
The automorphisms of a Riemann surface $R$ are in bijection with those of its field of meromorphic functions $\mathbb{C}(R)$.
\end{proposition}

Let now $\pi : R \to S$ be holomorphic; it gives a field extension $\mathbb{C}(S) \subset \mathbb{C}(R)$.

\begin{proposition}
The automorphisms of $R$ that commute with $\pi$ are precisely the automorphisms of $\mathbb{C}(R)$ which fix $\mathbb{C}(S)$.
\end{proposition}

\begin{corollary}
A map $\pi : R \to S$ defines a Galois extension on the fields of meromorphic functions if and only if there exists a group $\Gamma$ of automorphisms of $R$, commuting with $\pi$, and acting \textbf{simply transitively} on the fibres $\pi^{-1}(s)$, for a general $s \in S$.
\end{corollary}

\begin{proof}
Note first that any automorphism of $R$, commuting with $\pi$, which fixes a point of valency $1$ must be the identity.  
Indeed, by continuity, it will fix an open neighbourhood of the point in question, and the unique continuation property of analytic maps shows it to be the identity.  
Now, if $\mathbb{C}(R)$ is Galois over $\mathbb{C}(S)$, the order of the group of automorphisms is $[\mathbb{C}(R):\mathbb{C}(S)]$.  
So the automorphism group must act simply transitively on the fibres which do not contain branch points.  
Conversely, an automorphism group acting simply transitively on even one fibre with no branch points must have order $\deg \pi$.  
But since that is $[\mathbb{C}(R):\mathbb{C}(S)]$, it follows that the extension is Galois.
\end{proof}
Such a map is called a \textbf{Galois cover with group $\Gamma$}.

\begin{remark}
Note that $R/\Gamma = S$, set theoretically.  
Topology tells us that the $\Gamma$-invariant continuous functions on $R$ are precisely the continuous functions on $S$.  
We have just shown the same for the meromorphic functions.
\end{remark}

\begin{example}[Galois covers]
    \leavevmode
\begin{enumerate}
    \item[(i)] $\mathbb{P}^1 \longrightarrow \mathbb{P}^1$, with $w \longmapsto z = w^3$.\\[4pt]
    The automorphisms are $z \mapsto \zeta z$, where $\zeta$ is any cube root of $1$.

    \item[(ii)] $\mathbb{C}/L \longrightarrow \mathbb{P}^1$, with $u \longmapsto \wp(u)$.\\[4pt]
    The non-trivial automorphism is $u \longmapsto -u$.\\[4pt]
    Rewriting it, the surface $w^2 = 4z^3 - g_2 z - g_3$ is a Galois cover of the $z$-plane, with Galois group $\mathbb{Z}/2$ and automorphism $w \mapsto -w$.
\end{enumerate}
\end{example}

\begin{definition}
A differential $1$-form on a Riemann surface is called \textbf{holomorphic} if, in any local analytic coordinate, it has an expression
\[
\phi(z)\,dz = \phi(z)(dx + i\,dy),
\]
with $\phi$ holomorphic.
\end{definition}

For those of you familiar with the notion of differential forms on a surface, there is a hands-on (but dirty) definition:

\begin{definition}
A \textbf{holomorphic differential} on a Riemann surface $R$ is a quantity which takes the form $\phi(z)\,dz$ in a local coordinate $z$, and on the overlap region with another coordinate $u$, where it has the form $\psi(u)\,du$, it satisfies the gluing law
\[
\phi(z) = \psi(u(z))\,u'(z).
\]
(Formally, $du = u'(z)\,dz$.)
\end{definition}

\begin{proposition}
If $f$ is a holomorphic function on $R$, then $df$ represents a holomorphic differential.  
In a local coordinate $z$,
\[
df = f'(z)\,dz.
\]
\end{proposition}

\begin{remark}
We are trying to talk about derivatives of functions on a Riemann surface.  
However, the derivative of a function does not transform like a function under a change of coordinates, because of the chain rule
\[
\frac{df}{dz} = \frac{df}{du} \frac{du}{dz}.
\]
Differentials are quantities which transform like derivatives of functions. They are not functions because the "value" of a differential at a point is not well-defined (it depends on the choice of local coordinate). However, its value evaluated on a tangent vector is well-defined, precisely because of the chain rule.
\end{remark}

\begin{proposition}
If $\phi$ is a holomorphic differential and $f$ is a holomorphic function, then $f \cdot \phi$ is a holomorphic differential.
\end{proposition}

If $\phi$ and $\psi$ are two holomorphic differentials, then $\phi/\psi$ is a meromorphic function.  
If $\phi$ is holomorphic if and only if the zeroes of $\psi$ are “dominated” by the zeroes of $\phi$, that is, in local coordinate $z$ when
\[
\phi = \phi(z)\,dz, \qquad \psi = \psi(z)\,dz,
\]
the order of the zeroes of $\psi$ is $\le$ the order of the zeroes of $\phi$.

\begin{remark}
There is an obvious notion of a meromorphic differential, and there are analogous properties to the above.
\end{remark}


\begin{example}[Holomorphic differentials]
    \leavevmode
\begin{enumerate}
\item[(i)] \textbf{Holomorphic differentials on $\mathbb{P}^1$ are zero.}

Indeed, over the usual chart $\mathbb{C}$, the differential must take the form $f(z)\,dz$ with $f$ holomorphic.  
Near $\infty$, with $w = 1/z$ as a coordinate, the differential becomes
\[
f(1/w)\,d(1/w) = -f(1/w)\,dw/w^2.
\]
So we need $f(1/w)/w^2$ to be holomorphic at $w = 0$, so $f$ should extend holomorphically at $\infty$ and have a double zero there.  
But then $f$ must be zero.

\item[(ii)] \textbf{Holomorphic differentials on the Riemann surface $w^4 + z^4 = 1$.}

The branch points of the projection to the $z$-plane are at $z = \pm1, \pm i$; $w = 0$ at all of them.  
The map has degree $4$ and branching index $3$ at each of the points.  
At $\infty$, we have four separate sheets defined by $w = \sqrt[4]{1 - z^4}$ which has four convergent expansions in $1/z$, as soon as $|z| > 1$.  
So Riemann–Hurwitz gives
\[
g(R) - 1 = -4 + \tfrac{1}{2} \cdot 12 = 2, \qquad g(R) = 3.
\]
Thus $R$ is a genus $3$ surface with $4$ points at $\infty$.

Now $dz$ defines a meromorphic differential on $R^{\mathrm{cpt}}$, because $z$ is a meromorphic function there.  
At $\infty$, on $R^{\mathrm{cpt}}$, $u = z^{-1}$ is a local holomorphic coordinate, and $dz = -u^{-2}du$ has a double pole.

On the other hand, I claim that $dz$ has a triple zero at each of the branch points.  
Indeed, by the theorem on the local form of an analytic map, there is a local coordinate $v$ with $z - 1 = v^4$.  
So
\[
dz = d(v^4) = 4v^3\,dv
\]
has a triple zero over $z = 1$, and similarly over the other branch points.

So $dz/w^2$, $dz/w^3$ are still holomorphic at the branch points (and everywhere else when $z \neq \infty$, because $w \neq 0$).  
At $z = \infty$, $w$ has a simple pole on $R^{\mathrm{cpt}}$ and we see that $w^{-2}dz$ and $w^{-3}dz$ (and higher powers) are non-singular there.  
Moreover, we can even afford to add $z\,dz/w^3$ to our list, and we have produced three holomorphic differentials on $R^{\mathrm{cpt}}$.


\begin{remark}
It is easy to see that the three are linearly independent.  
It takes more work to show that any holomorphic differential is a linear combination of these three.
\end{remark}

At any rate, we observe the following:

\begin{proposition}
The ratios of holomorphic differentials on $R^{\mathrm{cpt}}$ generate the field of meromorphic functions.
\end{proposition}

\begin{proof}
\[
\frac{dz/w^2}{dz/w^3} = w, \qquad
\frac{z\,dz/w^3}{dz/w^3} = z,
\]
and $z, w$ generate the field of meromorphic functions, by our theorem from last time.
\end{proof}

\end{enumerate}
\end{example}

\section{Line bundles and divisors}
If $f$ is a nonconstant meromorphic function on a compact Riemann surface $R$, then we defined the divisor of $f$ to be \[(f) = \sum_{p \in R} \operatorname{ord}_p(f) p\] where $\operatorname{ord}_p(f)$ is the order of vanishing of $f$ at $p$ (negative if $f$ has a pole at $p$). 

We defined the following sets:
\begin{align*}
    \Div(R) & = \{\text{formal finite sums } \sum n_p p, n_p \in \mathbb{Z}\} \\
    \PDiv(R) & = \{\text{divisors of meromorphic functions}\} \\
    \Cl(R) & = \Div(R)/\PDiv(R)
\end{align*} and there is a map \begin{align*}
    \Div(R) & \to \Pic(R) \\
    D & \mapsto \mathcal{O}(D)
\end{align*} where \begin{align*}
    \mathcal{O}(D)(U) & = \{f \text{ meromorphic on } U : (f)|_U + D|_U \geq 0\}
\end{align*} is an invertible sheaf. More precisely, from $D$ one gets an invertible sheaf $\mathcal{O}(D)$ along with a meromorphic section $s_D$ such that $(s_D)=D$. 

One can think of $s_D$ as the constant function $1$. In particular, recall that $\mathcal{O}(D)$ is locally isomorphic to $\mathcal{O}_R$ by picking local defining equations $\eta_\alpha$ for $D$ on an open cover $U_\alpha$. Recall that on a smooth variety there is an equivalence between Cartier divisors and Weil divisors.
Then the isomorphism $\mathcal{O}(D)|_{U_\alpha} \to \mathcal{O}_R|_{U_\alpha}$ is given by multiplication by $\eta_\alpha$. Then the canonical meromorphic section $s_D$, when restricted to $U_\alpha$, is given by $\eta_\alpha$ which has divisor $D|_{U_\alpha}$.

Therefore, there is an isomorphism of abelian groups \begin{align*}
    \Cl(R) & \to \text{subgroup of } \Pic(R) \text{ consisting of invertible sheaves admitting meromorphic sections} \\
    D & \mapsto (\mathcal{O}(D), 1)
\end{align*} and this is in fact an isomorphism of groups because of the following theorem.

\begin{theorem}
    Every $\cL$ on a Riemann surface has a nonzero meromorphic section. More generally, every vector bundle admits a global meromorphic frame.
\end{theorem}
\begin{remark}
    The compact case follows from the Kodaira vanishing theorem. In the noncompact case, all holomorphic vector bundles on noncompact $R$ are trivializable and therefore admit a global holomorphic frame.
\end{remark}

\begin{remark}[Confusion about degrees of meromorphic functions/sections]
    By definition of the invertible sheaf $\mathcal{O}(D)$, its holomorphic sections are those rational functions $f \in \mathbb{C}(R)$ such that $(f) + D \geq 0$. The degree of a meromorphic function is zero. However, the same function interpreted as a section of $\mathcal{O}(D)$ has degree $\deg D$. This is because the transition functions of $\mathcal{O}(D)$ introduce additional zeroes/poles to the section.

    For example, consider the line bundle $\cO_{\P^1}(1)$ on $\P^1$, and let $z$ be the coordinate near zero, $w$ the coordinate near infinity. Then $z$ is a meromorphic function on $\P^1$, it has a simple zero at $0$ and a simple pole at $\infty$, so it has degree zero as a meromorphic function. 

    However we can also consider it as a section of $\cO_{\P^1}(1)$. Recall that $\cO_{\P^1}(1)$ is constructed by taking two copies of $\C$ with coordinates $e_0, e_\infty$ and gluing them on the overlap by $e_\infty = w e_0$. 

    A section of $\cO_{\P^1}(1)$ is given by a pair of functions $(s_0(z)e_0, s_\infty(w)e_\infty)$ so that on the overlap, both expressions agree. In particular \[s_0(z)e_0 = s_\infty(w)e_\infty = s_\infty(w)(w e_0)\] so the rule becomes \begin{align*}
        s_\infty(w) & = ws_0(1/w)
    \end{align*}
    Therefore the section corresponding to the meromorphic function $z$ is given by \begin{align*}
        s_0(z) & = z \\
        s_\infty(w) & = w s_0(1/w) = w \cdot (1/w) = 1
    \end{align*} so as a section of $\cO_{\P^1}(1)$, $z$ has a simple zero at $0$ and is nonvanishing at $\infty$. Therefore as a section of $\cO_{\P^1}(1)$, $z$ has degree $1$. In particular it is a global holomorphic section of $\cO_{\P^1}(1\cdot \infty)$.

    A meromorphic section of $\cO(D)$ also comes from a meromorphic function and it will have the same degree as $D$. In particular, if $\cO(D)$ has a nonzero holomorphic section, then the degree of a meromorphic section will equal the degree of a holomorphic section, which we aptly call the degree of the line bundle.

    The point is that sometimes line bundles do not admit holomorphic sections, for example $\cO_{\P^1}(-1)$ has no nonzero holomorphic sections. In that case, the degree of the line bundle is still defined, and it is precisely the degree of any meromorphic section (which always exists by the above theorem). 
    
    Those line bundles with a nonzero holomorphic section are precisely those which come from effective divisors, i.e. $\cL \cong \cO(D)$ with $D \geq 0$. This is because if $\cL$ has a nonzero holomorphic section $s$, then $(s) \geq 0$ is an effective divisor and $\cL \cong \cO((s))$. Conversely if $\cL \cong \cO(D)$ with $D \geq 0$, then the constant function $1$ is a nonzero holomorphic section of $\cO(D)$.

However it is not true that every line bundle of nonnegative degree is linearly equivalent to an effective divisor, unless $g=0$. Consider the line bundle $\cO_X(p - q)$ of degree zero for distinct points $p,q \in X$. If this line bundle were effective, then there would exist a nontrivial holomorphic section $s$ of $\cO_X(p - q)$. This would immediately give an isomorphism to $\P^1$. So every curve of genus $g \geq 1$ has non-effective degree-zero line bundles. See Remark \ref{rmk:non-effective} for another viewpoint.
\end{remark}

Recall that the multiplicative Cousin problem is the problem of finding a global meromorphic function with prescribed zeroes and poles. The additive Cousin problem is the problem of finding a global meromorphic function with prescribed principal parts. The above theorem shows that both problems are always solvable on a noncompact Riemann surface.
\begin{theorem}
    On a noncompact Riemann surface, the multiplicative and additive Cousin problems are always solvable. Moreover every holomorphic vector bundle on a noncompact Riemann surface is trivializable.
\end{theorem}

\begin{definition}
    [Degree of a line/vector bundle] The degree of a line bundle $\cL$ on a compact Riemann surface $R$ is defined to be the degree of any meromorphic section of $\cL$. This is well defined because if $s,s'$ are two meromorphic sections of $\cL$, then $s/s'$ is a meromorphic function on $R$ and has degree $0$.

    The degree of a vector bundle $\cE$ is defined to be the degree of its determinant line bundle $\det \cE = \wedge^{\operatorname{rank} \cE} \cE$.
\end{definition}

\begin{fact}
On a compact Riemann surface, the degree and dimension of a vector bundle completely determine the topology of the bundle.
\end{fact}

\begin{proposition}
    Every holomorphic line bundle on $\P^1$ is isomorphic to $\mathcal{O}_{\P^1}(n)$ for some integer $n$.
\end{proposition}

\begin{proof}
    We can solve the multiplicative Cousin problem on $\P^1$ for degree zero divisors.
\end{proof}

\begin{proposition}
    Let $E = \C/L$ be an elliptic curve. Then \begin{align*}
        0 \to E & \to \Pic(E) \to \Z \to 0 
    \end{align*}
    is a short exact sequence of abelian groups. It splits, so $\Pic(E) \cong E \times \Z$.
\end{proposition}

\begin{example}
    [Doubled lattice] Recall that every ellptic curve $E = \C/L$ has a degree four cover by $\tilde E = \C/2L$. We defined four $\theta$ functions on $E$, let $\cL_i$ be the corresponding line bundles. Then $\pi^*\cL_i$ are all isomorphic on $\tilde E$ because the beriodicity conditions all become the same after doubling the lattice. Moreover recall that there is a map \begin{align*}
        E \to \P^3, \quad z \mapsto [\theta_1(z,\tau):\theta_2(z,\tau):\theta_3(z,\tau):\theta_4(z,\tau)]
    \end{align*} which is in fact a projective embedding by a line bundle.
\end{example}
Recall that in general if one has $\cL$ a line bundle on $X$, then we can consider the evaluation map $X \to \P(H^0(X,\cL)^*)$ given by $x \mapsto \{s \in H^0(X,\cL) : s(x)=0\}$ when $\cL$ has enough sections. For example, if $\cL$ has negative degree than it has no sections. If $\cL$ has degree $0$ then it has a section if and only if it is trivial. 

The analog of $\otimes \cO(D)$ for vector bundles is called an elementary transformation. Let $V$ be a vector bundle on $R$ and choose a subspace $S\subset V_p$. 

Define $\operatorname{elm}(V,p,S)$ to be the sheaf of sections of $V$ whose value at $p$ lies in $S$. This is a vector bundle whose degree is $\deg V - \codim S$.
\begin{align*}
    0 \to \operatorname{elm}(V,p,S) & \to V \to (V_p/S) \otimes \cO_p \to 0
\end{align*} Therefore there is a short exact sequence of vector spaces \begin{align*}
    0 \to K & \to \operatorname{elm}(V,p,S)_p \to S \to 0
\end{align*} with the property that \begin{align*}
    \operatorname{elm}(\operatorname{elm}(V,p,S),p,K) & \cong V(-x)
\end{align*} and so elementary transformations are invertible up to twisting by a line bundle (which is also invertible). This resolves the obvious obstruction that elementary transformations reduce the degree of a vector bundle.



\begin{proposition}
    Every vector bundle is obtained from a trivial vector bundle by a finite sequence of elementary transformations and tensoring by line bundles.
\end{proposition}

\begin{exercise}
Let $V$ be a rank~2 (for simplicity) vector bundle over a Riemann surface~$R$. 
Assume that $V$ has two meromorphic sections $s_1, s_2$ which, at some point, 
are holomorphic and span the fiber.

\begin{enumerate}[(a)]
    \item Show that this will be the case everywhere except at a set of isolated points.
    \item At an exceptional point, show that we can modify~$V$ by a finite sequence 
    of elementary transformations so that $s_1$ and $s_2$ form a holomorphic frame 
    of the new bundle.
\end{enumerate}
\end{exercise}


\begin{solution}
Let $s_1, s_2$ be two meromorphic sections of a rank 2 vector bundle $V$ over a Riemann surface $R$. Since $V$ is a holomorphic vector bundle, there exists a local trivialization of $V$ around $p$. \begin{align*}
        V|_U \cong \cO_U e_1 \oplus \cO_U e_2
    \end{align*} and we can write \begin{align*}
        s_1 = f_1 e_1 + f_2 e_2, \quad s_2 = g_1 e_1 + g_2 e_2
    \end{align*} where $f_i, g_i$ are meromorphic functions on $U$. The failure of $s_1, s_2$ to span the fiber at a point $q \in U$ is given by the vanishing of the determinant \begin{align*}
        D(q) = f_1(q)g_2(q) - f_2(q)g_1(q).
    \end{align*} which is a meromorphic function on $U$. The zeroes of a meromorphic function are isolated unless the function is identically zero. Since $s_1, s_2$ span the fiber at $p$, $D$ is not identically zero. Therefore, the set of points where $s_1, s_2$ fail to be holomorphic or fail to span the fiber is a discrete set of isolated points in $R$, because meromorphic functions can only have isolated singularities and the determinant $D$ is meromorphic.

    Let $D$ be the effective divisor of the poles of $s_1, s_2$. We can make $s_1, s_2$ holomorphic by twisting $V$ with the line bundle $\cO(D)$, i.e. consider the new vector bundle \begin{align*}
        V(D) = V \otimes \cO(D)\end{align*} Then $s_1, s_2$ are holomorphic sections of $V(D)$. Now consider a point $p$ where $s_1, s_2$ fail to span the fiber of $V(D)$. If $s_1(p)$ and $s_2(p)$ both vanish, then twist by an appropriate power of $\cO(-p)$ to make at least one of them non-vanishing at $p$, say $s_1(p) \neq 0$. In a chart near $V(D)$ we have a local trivialization $V(D)|_U \cong \cO_U e_1 \oplus \cO_U e_2$ so that $s_1 = e_1$ and $s_2 = f(z)e_1 + g(z)e_2$ for some holomorphic functions $f(z), g(z)$. Let $L = \C e_1 \subset V_p$. We can perform an elementary transformation of $V(D)$ at $p$ with respect to $L$ to obtain a new vector bundle $V'$ which fits into the short exact sequence of coherent sheaves \begin{align}
        0 \to V' \to V(D) \to (V(D)_p/L) \otimes \cO_p \to 0.
    \end{align} 
    The wedge product of the sections is given by \begin{align*}
        s_1 \wedge s_2 = g(z) e_1 \wedge e_2.
    \end{align*} Since $s_1, s_2$ fail to span the fiber at $p$, we have $g(0) = 0$, so we can write $g(z) = z^n h(z)$ for some $n \geq 1$ and unit $h(0) \neq 0$. After absorbing the unit $h(z)$ into $e_2$, we can assume $g(z) = z^n$. Then we have in local coordinates sections $s_1 = e_1$ and $s_2 = f(z) e_1 + z^n e_2$. 
    
    The elementary transformation $V'$ is locally generated by the sections $s_1' = e_1$ and $s_2' = z e_2$. This is because $V'(U)$ consists of sections of $V(D)(U)$ whose value at $p$ lies in $L = \C e_1$. Any section of $V(D)(U)$ can be written as $a(z)e_1 + b(z)e_2$ for some holomorphic functions $a(z), b(z)$. The condition that the value at $p$ lies in $L$ means that $b(0) = 0$, so we can write $b(z) = z c(z)$ for some holomorphic function $c(z)$. Therefore, sections of $V'(U)$ are of the form \begin{align*}
        a(z)e_1 + z c(z)e_2, \quad a(z), c(z) \in \cO_U
    \end{align*} which means $V'(U)$ is a $\cO_U$-module freely generated by $e_1$ and $z e_2$. In particular, the bundle $V'$ is locally trivialized by the sections $e_1$ and $e_2' = z e_2$. In the new bundle $V'$, the sections $s_1$ and $s_2$ have wedge product \begin{align*}
        s_1' \wedge s_2' = z^{n-1} e_1 \wedge e_2'.
    \end{align*} Thus, the order of vanishing of the wedge product at $p$ has decreased by 1. By repeating this process a finite number of times, we can obtain a vector bundle where $s_1, s_2$ span the fiber at $p$. By performing this procedure at each point where $s_1, s_2$ fail to span the fiber, we can obtain a vector bundle where $s_1, s_2$ form a holomorphic frame everywhere.
\end{solution}

\begin{remark}
The argument generalizes to any dimension. If $R$ is compact, it follows that we can trivialize~$V$ by a finite number of elementary transformations. If $R$ is non-compact, one can show that every vector bundle is in fact trivial.
\end{remark}




\begin{theorem}
    Every vector bundle on $\P^1$ is isomorphic to a direct sum of line bundles.
\begin{align*}
    V & \cong \bigoplus_{i=1}^{\operatorname{rank} V} \mathcal{O}_{\P^1}(n_i)
\end{align*}
where $n_i \geq n_{i+1}$. Moreover, the $n_i$ are uniquely determined by $V$.
\end{theorem}
The degree of $V$ is $\sum n_i$. 
\begin{example}
    On $\P^1$, we have homeomorphic but not biholomorphic vector bundles $\cO(1) \oplus \cO(-1)$ and $\cO \oplus \cO$. They both have degreee zero and the same number of sections, but the sections sit inside the bundles differently.
\end{example}

\section{Riemann-Roch theorem for vector bundles}

\section{Coherent sheaf cohomology}

Recall if $V$ is a vector bundle on a compact Riemann surface $R$, then we proved that \begin{align*}
    \chi(R,V) & = \dim H^0(R,V) - \dim H^1(R,V) = \deg V + \operatorname{rank} V (1-g)
\end{align*} Moreover, we saw that any coherent sheaf $\cS$ on $R$ locally splits as a direct sum of a vector bundle and a torsion sheaf supported at finitely many points. More precisely, there is a short exact sequence \begin{align*}
    0 \to \cT & \to \cS \to V \to 0
\end{align*} where $\cT$ is the subsheaf of torsion sections of $\cS$ and $V$ is a vector bundle. This short exact sequence is canonical but the splitting is not. 

We have $H^0(R,\cT)$ has dimension the global length of $\cT$. We define \begin{align*}
    H^1(R,\cT) & = 0
\end{align*} and this is justified because \begin{align*}
    \cM \otimes_{\cO} \cT & = 0 \\
    \cP \otimes_{\cO} \cT & = 0
\end{align*} where $\cM$ is the sheaf of meromorphic functions and $\cP = \cM/\cO$ is the sheaf of principal parts. Define \begin{align*}
    \deg \cT & = \dim H^0(R,\cT)
\end{align*} In particular, this definition of $H^*(R,\cT)$ is justified because it is compatible with the Riemann-Roch theorem for coherent sheaves and it makes degree additive in short exact sequences. For example, one can check that \begin{align*}
    0 \to \cO(-np) \to \cO & \to \C\set{z}/(z^n) \to 0
\end{align*} where $p$ is a point with local coordinate $z$ and $\C{z}$ denotes the ring of germs of holomorphic functions at $p$. 

\begin{theorem}[Long exact sequence in cohomology]\label{theorem:long_exact_sequence_cohomology}
    Let \begin{align*}
        0 \to \cS' & \to \cS \to \cS'' \to 0
    \end{align*} be a short exact sequence of coherent sheaves on a compact Riemann surface $R$. Then there is a long exact sequence in cohomology \begin{align*}
        0 \to H^0(R,\cS') & \to H^0(R,\cS) \to H^0(R,\cS'') \to H^1(R,\cS') \to H^1(R,\cS) \to H^1(R,\cS'') \to 0
    \end{align*} and the Euler characteristic is additive \begin{align*}
        \chi(R,\cS) & = \chi(R,\cS') + \chi(R,\cS'')
    \end{align*}
\end{theorem}

To prove this theorem, we will introduce spectral sequences in a limited context. Let $(\cS^{\bullet},d^{\bullet})$ be a complex of coherent sheaves of finite length on a compact Riemann surface $R$. We can form a double complex 
\[
\begin{tikzcd}[row sep=2em]
    \cdots \arrow[r] & \mathcal{P}(\mathcal{S}^i) \arrow[r, "d^i"] & \mathcal{P}(\mathcal{S}^{i+1}) \arrow[r] & \cdots \\
    \cdots \arrow[r] & \mathcal{M}(\mathcal{S}^i) \arrow[r, "d^i"] \arrow[u, "p^i"] & \mathcal{M}(\mathcal{S}^{i+1}) \arrow[r] \arrow[u, "p^{i+1}"] & \cdots \\
\end{tikzcd}
\] where $\mathcal{M}(\mathcal{S}^i)$ is the sheaf of meromorphic sections of $\mathcal{S}^i$ and $\mathcal{P}(\mathcal{S}^i) = \mathcal{M}(\mathcal{S}^i)/\mathcal{S}^i$ is the sheaf of principal parts. The vertical maps $p^i$ are the natural projections. We can form the total complex \begin{align*}
    \operatorname{Tot}^n(\mathcal{S}^{\bullet}) & = \cP(\mathcal{S}^{n-1}) \oplus \mathcal{M}(\mathcal{S}^n) \\
    d_{\operatorname{Tot}}^n & = d_{\cP}^{n-1} + (-1)^n d_{\mathcal{M}}^n
\end{align*} We define the hypercohomology of the complex $\mathcal{S}^{\bullet}$ to be \begin{align*}
    \mathbb{H}^k(R,\mathcal{S}^{\bullet}) & =  H^k(\Gamma(R,\operatorname{Tot}^{\bullet}(\mathcal{S}^{\bullet})))
\end{align*} We want to relate $\mathbb{H}^k(R,\mathcal{S}^{\bullet})$ to the cohomology of the individual sheaves $\mathcal{S}^i$. Note the vertical differential computes exactly $H^*(R,\mathcal{S}^i)$. So if all the horizontal differentials were zero, we would have \begin{align*}
    \mathbb{H}^k(R,\mathcal{S}^{\bullet}) & = \bigoplus_{i+j=k} H^j(R,\mathcal{S}^i) = H^0(R,\mathcal{S}^k) \oplus H^1(R,\mathcal{S}^{k-1})
\end{align*} In general, the horizontal differentials are not zero and we only have the following approximation.
\begin{theorem}[Hypercohomology long exact sequence]\label{theorem:hypercohomology_long_exact_sequence}
    There is a long exact sequence \begin{align*}
        \cdots \to \ker{d^k\vert_{H^0(R,\mathcal{S}^k)}} \bigg / \operatorname{im}{d^{k-1}\vert_{H^0(R,\mathcal{S}^{k-1})}} & \to \mathbb{H}^k(R,\mathcal{S}^{\bullet}) \to \ker{d^{k-1}\vert_{H^1(R,\mathcal{S}^{k-1})}} \bigg/ \operatorname{im}{d^{k-2}\vert_{H^1(R,\mathcal{S}^{k-2})}} \to \cdots
    \end{align*}
\end{theorem}
We will get this theorem as a special case of the spectral sequence associated to a double complex. This presents the hypercohomology $\mathbb{H}^k(R,\mathcal{S}^{\bullet})$ as an extension of a subspace of the right term by a quotient of the left term. These terms are computable from $H^*(R,\mathcal{S}^i)$ and the differentials $d^i$.

This is an example of the spectral sequence associated to a double complex. \begin{align*}
    T^k = \bigoplus_{p+q=k} C^{p,q}
\end{align*} Then we can compute the hypercohomology of the total complex knowing something about the vertical differential. We can do a page by page computation, taking the total complex as the $E^0$ page. Then the $E^1$ page is given by taking the cohomology with respect to the vertical differential. The only maps which survive are the horizontal differentials induced on the cohomology groups. 
\[
\begin{tikzcd}[row sep=2em]
    \cdots \arrow[r] & H^{q+1}(C^{p,\bullet}) \arrow[r, "d_1"] & H^{q+1}(C^{p+1,\bullet}) \arrow[r] & \cdots \\
    \cdots \arrow[r] & H^q(C^{p,\bullet}) \arrow[r, "d_1"] & H^q(C^{p+1,\bullet}) \arrow[r] & \cdots
\end{tikzcd}
\]
The $E^2$ page looks like:
\begin{center}
    \begin{tikzpicture}[
  dot/.style={circle,fill,inner sep=1.8pt},
  diff/.style={->,thick,>=Latex},
  labelstyle/.style={font=\scriptsize,anchor=south west}
]

% axes
\draw[->] (0,0) -- (8.5,0) node[right] {$p$};
\draw[->] (0,0) -- (0,5.5) node[above] {$q$};

% grid of classes + labels
\foreach \p in {0,...,7}{
  \foreach \q in {0,...,4}{
    \node[dot] (A-\p-\q) at (\p,\q) {};
    \node[labelstyle] at (\p+0.1,\q+0.1) {$E^{\p,\q}_2$};
  }
}

% d_2 differentials: (p,q) -> (p+2,q-1)
\foreach \p in {0,...,5}{
  \foreach \q in {1,...,4}{
    \pgfmathtruncatemacro{\pp}{\p+2}
    \pgfmathtruncatemacro{\qq}{\q-1}
    \draw[diff] (A-\p-\q) -- (A-\pp-\qq);
  }
}
\end{tikzpicture}
\end{center}
\begin{theorem}
    There exists an induced second differential of bidegree $(2,-1)$ on the $E^2$ page \begin{align*}
        d_2^{p,q} & : E_2^{p,q} \to E_2^{p+2,q-1}
    \end{align*}
\end{theorem}
Our example had only two rows, so the $d_2$ differential was zero. In general, one can continue this process to get higher differentials \begin{align*}
    d_r^{p,q} & : E_r^{p,q} \to E_r^{p+r,q-r+1}
\end{align*} 
\begin{theorem}
    If or when the procedure stops, the $E^{p,q}_{\infty}$ page contains the associated graded of the cohomology of the total complex with respect to the filtration by the horizontal differential. More precisely, there is a filtration \begin{align*}
        0 = F^{n+1}H^k & \subset F^n H^k \subset \cdots \subset F^0 H^k = H^k(\operatorname{Tot}^{\bullet}(C^{\bullet,\bullet}))
    \end{align*} such that \begin{align*}
        E_{\infty}^{p,q} & \cong F^p H^{p+q} / F^{p+1} H^{p+q}
    \end{align*}
\end{theorem}

\begin{proof}
    [Proof of Theorem \ref{theorem:hypercohomology_long_exact_sequence}]
    The existence of the long exact sequence follows from applying the general theory. Suppose we have a spectral sequence $E_2^{p,q}$ converging to $L^{p+q}$ and we are in the nice case $E_2 = E_{\infty}$. So for each total degree n there is a finite filtration
\[0=F^{n+1}L^n\subset F^{n}L^n\subset\cdots\subset F^{1}L^n\subset F^{0}L^n=L^n\] Then we can write down the beginning of a long exact sequence by looking at total degree $1$:
\[
0\;\to\;E_2^{1,0}\;\to\;L^1\;\to\;E_2^{0,1}\;\xrightarrow{d_2}\;E_2^{2,0}\]
where the first map is the inclusion of $F^1L^1$ into $L^1$ and the second map is the projection onto $F^0L^1/F^1L^1$. Now we can proceed by looking at total degree $2$. We have a filtration
\[0=F^{3}L^2\subset F^{2}L^2\subset F^{1}L^2\subset F^{0}L^2=L^2\] with associated graded pieces
\[E_{\infty}^{2,0}\cong F^2L^2,\quad E_{\infty}^{1,1}\cong F^1L^2/F^2L^2,\quad E_{\infty}^{0,2}\cong F^0L^2/F^1L^2\] Thus we have a short exact sequence 
\[
E_2^{2,0}\;\to\;\ker(L^2\to E_2^{0,2})\;\to\;E_2^{1,1}\;\xrightarrow{d_2}\;E_2^{3,0}\] where the first map comes from the identification $\ker (L^2\to E_2^{0,2})=F^1L^2$ and the second map is the projection onto $F^1L^2/F^2L^2$. Splicing this with the previous exact sequence gives the long exact sequence \[0 \to E_2^{1,0} \to L^1 \to E_2^{0,1}
\xrightarrow{d_2}
E_2^{2,0} \to \ker\bigl(L^2 \to E_2^{0,2}\bigr)
\to E_2^{1,1} \xrightarrow{d_2} E_2^{3,0}\]
This is exactly the long exact sequence in the statement of Theorem \ref{theorem:long_exact_sequence_cohomology} since $E^{3,0}$ vanishes. More generally, we can proceed by looking at total degree $n$ and splicing the resulting short exact sequence with the previous long exact sequence to get the full long exact sequence.
\[
\cdots \longrightarrow E_2^{p,q}
\longrightarrow \ker(L^{p+q}\!\to E_2^{p-2,q+2})
\longrightarrow E_2^{p-1,q+1}
\xrightarrow{d_2} E_2^{p+1,q}
\longrightarrow \cdots
\]
\end{proof}

\section{Serre duality}
\subsection{Extensions of vector bundles}
Let \begin{align*}
    0 \to V' & \to V \to V'' \to 0
\end{align*} be a short exact sequence of vector bundles on a compact Riemann surface $R$. On a small open set $U$ we get an exact sequence of sheaves of sections \begin{align*}
    0 \to V'(U) & \to V(U) \to V''(U) \to 0
\end{align*} which are all free $\cO(U)$-modules of finite rank. A splitting of this sequence is given by \[s: V''(U) \to V(U)\] a choice of free generators of $V''(U)$ lifted to $V(U)$, and can be thought of as a local choice of frame of $V''$ (i.e. a choice of inclusion $U\times \C^{\operatorname{rank} V''} \to U\times \C^{\operatorname{rank} }V$). Such a splitting always exists locally, however there may not exist a global splitting.

\begin{example}
    Let $R = \P^1$ and consider the sequence \begin{align*}
        0 \to \cO \to \cO(0) \oplus \cO(\infty) & \to \cO(0 + \infty) \to 0
    \end{align*} where the maps are the diagonal inclusion and the subtraction map $(a,b) \mapsto a-b$. This sequence is exact.

    Exactness is clear away from $0$ and $\infty$. Near $0$, injectivity and surjectivity are clear. To see exactness in the middle, suppose $(a,b)$ maps to zero. Then $a=b$ as meromorphic functions on $\P^1$ and $a$ has no pole at $0$, $b$ has no pole at $\infty$, so $a=b$ is a constant function. Therefore, $(a,b)$ is in the image of the inclusion.

    However this sequence is not split because \begin{align*}
        \cO (1) \oplus \cO(1) & \not\cong \cO \oplus \cO(2)
    \end{align*} because we can tensor by $\cO(-2)$ and take global sections to see that the dimensions of global sections differ.
\end{example}

\begin{theorem}
An exact sequence of vector bundles on a compact Riemann surface
\begin{align*}
    0 \to V' & \to V \to V'' \to 0
\end{align*} determines a cohomology class in
\begin{align*}
     H^1(R, \mathcal{H}om(V'', V')) & \cong H^1(R, V' \otimes (V'')^*)
    \end{align*} and the sequence splits if and only if this class is zero.
\end{theorem}
\begin{example}
    In the previous example, we calcuated the unique (up to "scale") nonsplit extension of $\cO(2)$ by $\cO$, which determines a cohomology class in \begin{align*}
        H^1(\P^1, \cO(-2)) & \cong \C
    \end{align*}
    Addition of extensions corresponds to the operation \begin{align*}
        (A \to E \to B) + (A \to E' \to B) = A \to E \oplus_B E' \to B
    \end{align*} which makes sense in any category with kernels and cokernels. 
\end{example}

\begin{proof}
First we construct the class. Recall that we defined \begin{align*}
    H^1(R, V) & = \Gamma(R, \cP(V)) / \Gamma(R, \cM(V))
\end{align*} There is a diagram of vector spaces 
\begin{center}
\begin{tikzcd}
    0 \arrow[r] & \mathcal{M}(V')(R) \arrow[r] \arrow[d, "p'"] & \mathcal{M}(V)(R) \arrow[r] \arrow[d, "p"] & \mathcal{M}(V'')(R) \arrow[r] \arrow[d, "p''"] & 0 \\
    0 \arrow[r] & \mathcal{P}(V')(R) \arrow[r] & \mathcal{P}(V)(R) \arrow[r, "Q"] & \mathcal{P}(V'')(R) \arrow[r] & 0
\end{tikzcd}\end{center}
and since the top row is a sequence of finite dimensional vector spaces over $\cM(R)$, we can product a splutting \begin{align*}
    s & : \mathcal{M}(V'')(R) \to \mathcal{M}(V)(R)
\end{align*} This splitting in fact defines a splitting of sheaves \[s:\cM(V'') \to \cM(V)\] by restricting to smaller open sets. 

Now observe that $p\circ s:\cO(V'') \to \cP(V)$ in fact lands in $\cP(V')$ because \begin{align*}
    Q \circ p \circ s & = p'' 
\end{align*} and $p''$ vanishes on $\cO(V'')$. This gives a map $\cO(V'') \to \cP(V')$ of $\cO$-modules. Dualizing, we get \begin{align*}
    1 \in \cO \to \cP(V' \otimes V''^\vee)
\end{align*}
Changing $s$ changes the result by a meromorphic section of $V'$. So its class in cohomlogy is well defined, independent of $s$.
\end{proof}

\begin{remark}
    On $\P^1$, every vector bundle is a sum of line bundles and we still have nontrivial extensions. On higher genus Riemann surfaces, vector bundles are characterized by the Harder-Narasimhan filtration. \begin{align*}
        0 = V_0 \subset V_1 \subset \cdots \subset V_n = V
    \end{align*} with successive quotients semistable and decreasing slopes. The extensions between the successive quotients are nontrivial in general.

    In general, $0 \to V' \to V \to V'' \to 0$ we should expect that \begin{align*}
        \frac{\deg V''}{\rank V''} &\geq \frac{\deg V'}{\rank V'}
    \end{align*} and $H^1(R, \cH om(V'', V'))$ is bigger if degree of $V''$ is large or degree of $V'$ is small.
\end{remark}

\subsection{Serre duality}
Let $R$ be a compact Riemann surface, $V$ vector bundle on $R$. We have the canonical bundle $K_R = \Omega_R^1$ of holomorphic one-forms on $R$.
\begin{theorem}[Serre duality]
    There is an isomorphism of vector spaces, functorial in $R$:
    \begin{align*}
        H^0(R, V) & \cong H^1(R, K_R \otimes V^*)^* \\
        H^1(R, V) & \cong H^0(R, K_R \otimes V^*)^*
    \end{align*}
\end{theorem}
Functorial means that for $f: R \to S$ a nonconstant map of compact Riemann surfaces, we have the following commutative diagram:
\begin{center}
\begin{tikzcd}
    H^0(R, V) \arrow[r, "\cong"] \arrow[d, "f^*"] & H^1(R, K_R \otimes V^*)^* \arrow[d, "f^*"] \\
    H^0(S, V) \arrow[r, "\cong"] & H^1(S, K_S \otimes V^*)^*
\end{tikzcd}
\end{center}
We will say a little bit more about the map on $H^1$.
\begin{proof}
    The global residue pairing \begin{align*}
        H^0(R, V) \times H^1(R, K_R \otimes V^*) & \to \C 
    \end{align*} comes from a local residue pairing at a point $x\in R$. \begin{align*}
        \cO(V)_x \otimes \cP(K_R \otimes V^*)_x & \to \C \\
        (\sigma, \tau) & \mapsto \operatorname{Res}_x(\langle \sigma, \tau \rangle)
    \end{align*} In a local coordinate $z$ near $x$, the pairing takes the form \begin{align*}
        z^n u \otimes \frac{v}{z^m} dz & \mapsto \operatorname{Res}_x \left( \frac{u v}{z^{m-n}} dz \right) = \begin{cases}
            u(x)v(x) & m = n+1 \\
            0 & \text{otherwise}
        \end{cases}
    \end{align*}
    Note that the holomorphic part of a differential has no residue so the map is defined on $\cP(K_R \otimes V^*)_x$. The pairing is nondegenerate. The global residue pairing then is simply the sum of the local pairings over all points $x \in R$.

    We will establish that this pairing induces an isomorphism on the level of cohomology in the case $R = \P^1$. There, it suffices to check the case $V = \cO(n)$ for $n \in \Z$. Then we will reduce the general case to $\P^1$ by using the functoriality of the pairing and pushing forward along a branched cover $f: R \to \P^1$.

    We check the isomorphism for $\cO(n)$ on $\P^1$ for $n \geq -1$. Move to $\cO(n\infty)$. Check the residue pairing at $z=0$. May assume the principal parts are at $0$ and that meromorphic functions have only poles at $0$. In this case \begin{align*}
        H^0(\P^1, \cO(n\infty)) & = \operatorname{span}\set{1, z, z^2, \ldots, z^n} \\
        H^1(\P^1, K_{\P^1} \otimes \cO(-n\infty)) = \span\set{\frac{dz}{z},
        \frac{dz}{z^2}, \ldots, \frac{dz}{z^{n+1}}} 
    \end{align*}
\end{proof} because by the principal parts argument $dz/z^{n+2} = z^{-n} dz/z^n$ is holomorphic at $\infty$. The residue pairing is clear.

Now we can reduce to $\P^1$. Let $f: R \to \P^1$ be a branched cover. We want to know what is the functorial isomorphism \begin{align*}
    H^1(R, K_R \otimes V^*) & \to H^1(\P^1, K_{\P^1} \otimes f_* V^*)
\end{align*} Consider the isomorphisms
\[
H^i(R;V) \;\cong\; H^i(\mathbb{P}^1;\pi_*V)
\]
An isomorphism
\[
f_*\bigl(K_R \otimes V^\vee\bigr)
\;\cong\;
K_{\mathbb{P}^1} \otimes (f_*V)^\vee
\]
compatible with the residue pairings with $V$ on $R$ and $f_*V$ on $\mathbb{P}^1$
would complete the proof of duality. Now, by Lemma~3.10,
\[
(f_*V)^\vee \;\cong\; f_*\bigl(V^\vee(B)\bigr),
\]
so what we need is
\[
f_*\bigl(K_R \otimes V^\vee\bigr)
\;\cong\;
K_{\mathbb{P}^1} \otimes (f_*V)^\vee
\]
compatible with the residue pairings with $V$ on $R$ and $f_*V$ on $\mathbb{P}^1$
would complete the proof of duality. We can restate this as an isomorphism 
\begin{align*}
    K_{\P^1}^{-1} \otimes f_*(K_R \otimes V^*) & \cong f_*(V)^{\vee}
\end{align*} and by adjunction \begin{align*}
    f_*(K_R \otimes V^*) & \cong f_*(f^* K_{\P^1}^{-1} \otimes K_R \otimes V^*)
\end{align*}

Then we check that $K_R \otimes f^* K_{\P^1}^{-1} \cong \cO(B)$ where $B$ is the branch divisor of $f$.

Now, by Lemma~3.10,
\[
(f_*V)^\vee \;\cong\; f_*\bigl(V^\vee(B)\bigr),
\]
so what we need is
\[
f_*\bigl(K_R \otimes V^\vee\bigr)
\;\cong\;
K_{\mathbb{P}^1} \otimes (f_*V)^\vee
\]
The miracle that makes things match is that the pullback of differentials from
$\mathbb{P}^1$ to $R$ lands in $K_R(-B)$, and in fact generates the latter as an
$\mathcal{O}$-module over $R$. That is, we are saying that (in a local model
$w \mapsto z = w^n$ for $\pi$) the lift of the nonvanishing holomorphic differential
$dz$ has a zero of order exactly the branching index:
\[
d(w^n) = n w^{n-1} \, dw.
\]
So a local section of $K_R \otimes V^\vee$ can be written as $dz$ times a local
section of $V^\vee(B)$, which gives the desired isomorphism.

We can use the isomorphisms
\[
f_*\mathcal{P}_x(V) \;\cong\; \mathcal{P}_{f(x)}(f_*V),
\]
and the discussion of differentials at branch points, to check the compatibility of
residue pairings on $R$ and $\mathbb{P}^1$: choose local coordinates in standard
form and write the residue pairings in the Laurent basis.

\section{Abel Jacobi}
Recall the additive and multiplicative Cousin problems: 
\begin{itemize}
    \item Additive Cousin: Given a collection of principal parts on $R$, when does there exist a global meromorphic function with those principal parts?
    \item Multiplicative Cousin: Given a divisor $D$ on $R$, when does there exist a global meromorphic function $f$ with divisor $(f) = D$?
\end{itemize}
We have seen that for $g=0$, the additive Cousin problem always has a solution and the multiplicative Cousin problem has a solution if and only if the degree of the divisor is zero. For $g = 1$, the additive Cousin problem has a solution if and only if the sum of the residues is zero and the multiplicative Cousin problem has a solution if and only if the degree of the divisor is zero and the sum of the points (with multiplicity) modulo the period lattice is zero.

In general, the obstruction in the additive Cousin problem lies in $H^1(R, \cO)$ because we defined it to be so:
\begin{align*}
    H^1(R, \cO) & = \Gamma(R, \cP) / \Gamma(R, \cM)
\end{align*} where $\cP$ is the sheaf of principal parts and $\cM$ is the sheaf of meromorphic functions. We proved the Serre duality isomorphism \begin{align*}
    H^1(R, \cO) & \cong H^0(R, K_R)^*
\end{align*} so the obstruction to solving the additive Cousin problem can be computed by pairing with holomorphic one-forms. In particular, a collection of principal parts $\set{p_i}$ has a solution if and only if \begin{align*}
    \sum_i \operatorname{Res}_{x_i}(p_i \omega) & = 0
\end{align*} for all $\omega \in H^0(R, K_R)$.

Now we state some consequences of Riemann-Roch and Serre duality:
\begin{itemize}
    \item The degree of the canonical bundle is \begin{align*}
        \deg K_R & = 2g - 2
    \end{align*} In particular every meromorphic differential has exactly $2g-2$ zeros (counted with multiplicity). This agrees with the statement of the Poincare-Hopf theorem for vector fields, which says that if $M$ is a compact oriented surface, then every vector field with isolated zeros has total index equal to the Euler characteristic $\chi(M) = 2-2g$. For a holomorphic differential, the index of a zero is its multiplicity as a zero of the differential.
    \item For all $R$ with genus $g \geq 1$, for all $p\in R$ there exists a nontrivial holomorphic differential not vanishing at $p$. If not, then all holomorphic differentials zeroes at $p$ and so $h^0(R, K_R(-p)) = g$. This implies that $h^0(R,\cO(p)) = 2$ so there exists a nonconstant meromorphic function with a single simple pole at $p$. This function gives an isomorphism to $\P^1$ and so $g=0$, a contradiction.
    \item There exists a map of degree $g+1$ from $R$ to $\P^1$. This is because \begin{align*}
        h^0(R, \cO((g+1)p)) &= h^1(R, K_R(- (g+1)p)) + (g+1) - g + 1 \geq 2 
    \end{align*}
    \item Every genus $2$ curve has a degree 2 map to $\P^1$ and is therefore hyperelliptic. This is because for $g=2$, we have $h^0(\Omega^1) = 2$ so there exist two linearly independent holomorphic differentials $\omega_1, \omega_2$. They each have degree $2g-2 = 2$ zeros. If they have a common zero at $p$, then $\omega_1/\omega_2$ is a meromorphic function with a single simple pole at $p$, which is impossible on a genus $2$ curve. 
\end{itemize}
For $\deg L \geq 2g - 1$, one always has $h^0(L(p)) = h^0(L) + 1$ for all $p \in R$. However, for smaller degree line bundles, this can fail. The failure is measured by the following theorem.
\begin{theorem}
    [Weierstrass gap theorem] At each point $p$ of a compact Riemann surface of genus $g$, there are exactly $g$ integers \begin{align*}
        1 = n_1(p) < n_2(p) < \cdots < n_g(p) \leq 2g - 1
    \end{align*} such that \begin{align*}
        h^0(R, \cO(n_i(p) p)) & = h^0(R, \cO((n_i(p) - 1)p))
    \end{align*} These integers are called the Weierstrass gaps at $p$.
\end{theorem}
The generic sequence of gaps is \begin{align*}
    1, 2, \ldots, g
\end{align*} A point $p$ is called a Weierstrass point if its gap sequence differs from the generic one. For example, on a hyperelliptic curve, the Weierstrass points are the branch points of the degree $2$ map to $\P^1$ and have gap sequence \begin{align*}
    1, 3, 5, \ldots, 2g - 1
\end{align*} There are always finitely many Weierstrass points on a compact Riemann surface of genus $g \geq 2$.

\subsection{Differentials on a Riemann surface}
Recall that on a Riemann surface $R$, we have the Hodge star operator defined on all smooth differential 1-forms \begin{align*}
    * & : \Omega^1_{sm}(R) \to \Omega^1_{sm}(R)
\end{align*} defined in local holomorphic coordinates $z = x + iy$ by \begin{align*}
    *(f\,dx + g\,dy) & = -g\,dx + f\,dy
\end{align*} so that \begin{align*}
    *(dz) & = -i\, dz \\
    *(d\overline{z}) & = i\, d\overline{z}
\end{align*} The Hodge star operator satisfies \begin{align*}
    ** & = -1
\end{align*} on 1-forms. A differential form $\omega$ is called \textbf{harmonic} if \begin{align*}
    d\omega & = 0 \\
    d * \omega & = 0
\end{align*}
Recall that we had a decomposition of the square integrable smooth 1 forms on a compact Riemann surface $R$ \begin{align*}
    L^2 \Omega^1_{sm}(R) & = (dC^{\infty}(R)) \oplus H \oplus (*d C^{\infty}(R))
\end{align*} where $H$ is the space of harmonic 1-forms. Moreover, $H$ consists of smooth forms. Also recall that we defined an inner product on $L^2 \Omega^1_{sm}(R)$ by \begin{align*}
    \langle\alpha, \beta\rangle & = \int_R \alpha \wedge * \beta
\end{align*} The decomposition is orthogonal with respect to this inner product in the sense that \begin{align*}
    \langle d f, * d g\rangle & = 0
\end{align*} for all smooth functions $f,g$ on $R$.

Any closed differential form has $2g$ periods given by integrating over the edges of the polygonal decomposition of $R$. The form is exact if and only if all its periods vanish. 

\begin{enumerate}
    \item In particular, the space of harmonic forms is at most $2g$-dimensional because it injects into the space of period vectors $\R^{2g}$.
    \item There are $g$ linearly independent holomorphic differentials on $R$ and $g$ linearly independent antiholomorphic differentials on $R$, where holomorphic and antiholomorphic are defined as the $\pm i$ eigenspaces of the Hodge star operator $*$. Since eigenspaces don't intersect, we have \begin{align*}
        \dim H & \geq 2g
    \end{align*} Combining with the previous point, we have \begin{align*}
        \dim H & = 2g
    \end{align*} and the holomorphic and antiholomorphic differentials give bases for the eigenspaces.
\end{enumerate}

Let $a_1, \ldots, a_g, b_1, \ldots, b_g$ be the edges of the polygonal decomposition of $R$. Let $\phi, \phi'$ be holomorphic differentials, and $A_i = \int_{a_i} \phi$, $B_i = \int_{b_i} \phi$ and similarly for $\phi'$. Using Stokes' theorem, we can compute \begin{align*}
    0 & = \int_R \phi \wedge \phi' = \sum_{i=1}^g \left( \int_{a_i} \phi \int_{b_i} \phi' - \int_{b_i} \phi \int_{a_i} \phi' \right) = \sum_{i=1}^g (A_i B_i' - B_i A_i')
\end{align*} where the second equality comes from writing $\phi = dF$ (locally! there is monodromy) so that \begin{align*}
    \int_X \phi \wedge \phi' &= \int_P dF\wedge\phi' \\
    &= \int_P d(F\phi')-F\,d\phi' \\
&= \oint_{\partial P} F\,\phi' \\
&= \sum_{i=1}^g \left( \int_{a_i} F\phi' + \int_{b_i} F\phi' - \int_{b_i^{-1}} F\phi' - \int_{a_i^{-1}} F\phi' \right) \\
&= \sum_{i=1}^g \left( \int_{a_i}F\phi' - \int_{a_i^{-1}} (F\phi') \right) + \sum_{i=1}^g \left( \int_{b_i} F\phi' - \int_{b_i^{-1}} (F\phi') \right) \\
\end{align*} and the difference between integrating over $a_i$ and $a_i^{-1}$ is given by the period of $\phi$ over the cycle, that is precisely $A_i$. Similarly for $b_i$.
We also have the relation \begin{align*}
    \sum_i (A_i \overline{B_i} - B_i \overline{A_i}) = i\langle\phi, \phi'\rangle
\end{align*} 
We have the following consequences:
\begin{itemize}
    \item For any nonzero holomorphic differential $\phi$
\begin{align*}
    \Im( \sum _i A_i \overline{B_i} ) & > 0
\end{align*} 
\item A holomorphic differential with all periods real is zero. This is because \begin{align*}
    \sum_i (A_i \overline{B_i} - B_i \overline{A_i}) & = 0 = i<\phi, \phi>
\end{align*} so $\phi = 0$.
\item We can choose a basis of holomorphic differentials $\phi_1, \ldots, \phi_g$ such that \begin{align*}
    \int_{a_i} \phi_j & = \delta_{ij}
\end{align*} Then the period matrix \begin{align*}
    \Pi_{ij} & = \int_{b_i} \phi_j
\end{align*} is symmetric with positive definite imaginary part. In particular \begin{align*}
    [A | B] \to [I | \Pi]
\end{align*} where $[A|B]$ is the old period matrix, $\Pi$ is symmetric and $\Im \Pi$ is positive definite.
\item The periods form a lattice in $\C^g$ of rank $2g$.
\end{itemize} 
We are finally able to give a criterion for when a divisor is principal, completing the multiplicative Cousin problem.
\begin{theorem}[Abel's theorem]
    A divisor $D = \sum n_i p_i$ on a compact Riemann surface $R$ is principal if and only if \begin{align*}
        \deg D & = 0 \\
        \sum n_i \int_{p_0}^{p_i} \vec{\Phi} & \in \Lambda
    \end{align*} for all $j=1, \ldots, g$, where $\vec{\Phi} = (\phi_1, \ldots, \phi_g)$ is a vector whose entries are a basis of holomorphic differentials normalized so that $\int_{a_i} \phi_j = \delta_{ij}$ and $\Lambda$ is the period lattice generated by the integrals of the $\phi_j$ over the $a_i$ and $b_i$ cycles.  
\end{theorem}

\begin{remark}
    The Schottky problem asks for a characterization of which complex tori arise as the Jacobian of a Riemann surface. In other words, which period matrices $\Pi$ arise from Riemann surfaces. 

    For $g=2,3$ it is an open subset of the space of symmetric $g \times g$ matrices with positive definite imaginary part. For $g=4$ it is a hypersurface. The problem is still open.
\end{remark}

\begin{definition}
    The \textbf{Jacobian variety} of a compact Riemann surface $R$ of genus $g$ is the complex torus \begin{align*}
        J(R) & = \C^g / \Lambda
    \end{align*} where $\Lambda$ is the period lattice generated by the integrals of a basis of holomorphic differentials over the $a_i$ and $b_i$ cycles.
\end{definition}
The Jacobian is independent of the choice of basis of holomorphic differentials and choice of symplectic basis of $H_1(R, \Z)$ up to isomorphism of complex tori. It is a compact complex manifold of dimension $g$, and an abelian group. One can show that every connected abelian group which is a complex manifold (and where the group structure is holomorphic) is a quotient of $\C^g$ by a co-compact lattice. The specific properties of $[A|B]$ ($A^{-1}B$ is symmetric with positive
definite imaginary part) impose a further restriction. They give rise to principally polarized abelian varieties.

We can give another interpretation of Abel's theorem.
\begin{theorem}
    [Abel's theorem] The kernel of the Abel-Jacobi map \begin{align*}
        \operatorname{Div}^0(R) & \to J(R) \\
        D = \sum n_i p_i & \mapsto \sum n_i \int_{p_0}^{p_i} \vec{\Phi}
    \end{align*} is precisely the group of principal divisors on $R$. In particular, the Abel-Jacobi map descends to an isomorphism \begin{align*}
        \operatorname{Pic}^0(R) & \to J(R)
    \end{align*}
$J$ is isomorphic to the group $\Div^0(R)/\PDiv(R)$ of isomorphism classes of
degree-zero line bundles on $R$.
\end{theorem}


On line bundles, the group operation is the tensor product.
Note that both sides have natural holomorphic structures:
the divisor side can be built from symmetric powers of $R$,
and the period map to $J$ was given by integrating holomorphic forms,
and is thus holomorphic:
so we should suspect a stronger statement behind this.

Choose a point $r \in R$.
On the product $R \times J$, there is the family of holomorphic line bundles
over $R$ parametrized by the points of $J$, with trivialized fibers over the point $r$.
Without trivializing at $r$, each line bundle has a group $\C^\times$ of automorphisms,
and the family of line bundles is not uniquely determined:
for instance, you can tensor it with your favorite line bundle over the base $J$,
without changing the isomorphism type on any factor of $R$.

\begin{remark}[Rigidity and the Poincaré line bundle]
    Set $p:R\times J\to R$ and $q:R\times J\to J$. Given a family $L$ on $R\times J$ and a line bundle $M$ on $J$, define
\[
L' = L\otimes q^*M
\]

For any fixed $j\in J$, when we restrict to the fiber $R\times\{j\}$ we have:
\[
L'\big|_{R\times\{j\}} \cong L\big|_{R\times\{j\}} \otimes \big(q^*M\big)\big|_{R\times\{j\}} \cong L_j \otimes (M_j\otimes \mathcal{O}_R)
\]
where $M_j$ is the one-dimensional vector space (the fiber of $M$ at $j$). As a line bundle on $R$, $M_j\otimes \mathcal{O}_R$ is just the trivial line bundle on $R$ since there's no $R$-variation. Hence
\[
L_j \otimes (M_j\otimes \mathcal{O}_R) \cong L_j
\]
non-canonically (requiring a choice of basis of $M_j$). So for each $j$, the isomorphism class in $\Pic(R)$ is unchanged, meaning twisting by $q^*M$ does not change the isomorphism type on any $R$-fiber.

Globally over $R\times J$ though, $L$ and $L\otimes q^*M$ are typically not isomorphic unless $M$ is (canonically) trivial—the noncanonical choices of bases at each $j$ don't glue holomorphically in $j$.

The point is that locally near each $j\in J$, you can choose a trivialization of $M_j$, i.e. a nonvanishing holomorphic section of $M$ over a small neighborhood of $j$ in $J$. This choice gives an isomorphism between $L$ and $L\otimes q^*M$ over that neighborhood because we can use the local section to identify $M_j$ with $\C$. However, if one tries to do this globally over all of $J$, this is the same as choosing a global nowhere-vanishing holomorphic section of $M$, which exists if and only if $M$ is (canonically) trivial. So we see that twisting by $q^*M$ changes $L$ to a different family of line bundles on $R$ parametrized by $J$, even though the fiberwise isomorphism classes remain the same.

For a family $L \to R \times B$, any automorphism over $R \times B$ is multiplication by a nowhere-vanishing holomorphic function $u \in \Gamma(R \times B, \mathcal{O}^\times)$. Because $R$ is a compact Riemann surface, every holomorphic function on $R$ is constant, so
\[
\Gamma(R \times B, \mathcal{O}^\times) \cong \Gamma(B, \mathcal{O}_B^\times).
\]
For each $b \in B$, $u(\cdot,b)$ is a nonvanishing holomorphic function on $R$, hence constant in the $R$-direction; these constants vary holomorphically in $b$.


Both issues are resolved by choosing a trivialization $\alpha: L|_{\{r\}\times J} \xrightarrow{\cong} \mathcal{O}_J$. This is the data of a global holomorphic section of the line bundle $L|_{\{r\}\times J}$ which is nowhere vanishing.

Any automorphism of $L$ must now restrict to the identity on $\{r\}\times J$, forcing the multiplier in $\mathcal{O}_J^\times$ to be 1. So $\Aut(L,\alpha)=1$. Additionally, twisting by $q^*M$ sends the rigidified fiber to
\[
(L\otimes q^*M)|_{\{r\}\times J} \cong \mathcal{O}_J \otimes M \cong M
\]
which violates the chosen trivialization unless $M\cong\mathcal{O}_J$ with its chosen trivialization. Thus the $\Pic(J)$-torsor ambiguity also disappears.
\end{remark}

It turns out that these individual line bundles on $R$
assemble to a holomorphic line bundle
\[
\mathcal P \;\to\; R \times J,
\]
the \textbf{universal} or \textbf{Poincaré} line bundle (of degree zero). These objects $\mathcal P$ and $J$ can be characterized by a universal property:

\begin{proposition}
For any complex space $B$ and holomorphic line bundle $L \to R \times B$,
equipped with a trivialization on $\{r\} \times B$,
there is a unique holomorphic map $f_L : B \to J$
and isomorphism $f_L^* \mathcal P \cong L$.
\end{proposition}

\begin{remark}
The trivialization condition may seem curious but is necessary to make the statement work.
The actual moduli that universally parametrizes degree-zero line bundles on $R$
is an \textbf{algebraic stack} with underlying space $J$
and automorphisms forming a $\C^\times$–gerbe,
a principal $B\C^\times$–bundle over $J$.
This is split as $B\C^\times \times J$ by a choice of point $r \in R$.
\end{remark}

\begin{remark}
Let $C$ be a smooth projective curve over $k=\C$, and $J=\Pic^0_{C/k}$ be the Jacobian (the Picard scheme). For the unrigidified Picard stack $\mathbf{Pic}^0_{C/k}$, we work in the site $(\mathrm{Sch}/k)_{\mathrm{fppf}}$. For a $k$-scheme $B$, the fibered category $\mathbf{Pic}^0_{C/k}(B)$ is the groupoid of line bundles $L$ on $C\times B$ with $\deg(L|_{C\times\{b\}})=0$ for all $b\in B$. Morphisms are isomorphisms of line bundles over $C\times B$. For any object $L$, we have
    \[
    \underline{\mathrm{Aut}}(L)\cong\mathbb G_{m,B} \quad\text{(i.e. }\Aut(L)=\Gamma(B,\mathcal O_B^\times)\text{)}
    \]
    because $\underline{\mathrm{End}}(L)\cong\mathcal O_{C\times B}$. 

    There is a natural 1-morphism of stacks $p: \mathbf{Pic}^0_{C/k}\to \Pic^0_{C/k}=J$ sending a family $L$ to its class in the relative Picard functor $\Pic(C\times B/B)$. Crucially, twisting $L$ by $q^*M$ (with $q:C\times B\to B$, $M\in\Pic(B)$) does not change its image in $J(B)$.

    For the rigidified stack $\mathbf{Pic}^{0,r}_{C/k}$ (choosing a basepoint $r\in C(k)$), we add a trivialization along the section $i_r:B\hookrightarrow C\times B$, $i_r(b)=(r,b)$. Objects over $B$ are pairs $(L,\alpha)$ with $L$ as above and
    \[
    \alpha: i_r^*L \xrightarrow{\sim} \mathcal O_B
    \]
    a nowhere-vanishing holomorphic frame along $\{r\}\times B$. Morphisms are isomorphisms $\phi:L\to L'$ satisfying $i_r^*\phi\circ\alpha=\alpha'$.

    The key fact is that $\mathbf{Pic}^{0,r}_{C/k}$ is representable by the Jacobian $J$. More precisely, there is a canonical equivalence of stacks $\mathbf{Pic}^{0,r}_{C/k}\simeq J$, where the right side is viewed as the discrete stack $B\mapsto \Hom(B,J)$. This gives the universal property of the Poincaré line bundle $\mathcal P$ on $C\times J$.

    In the language of gerbes, the map $p:\mathbf{Pic}^0_{C/k}\to J$ has fibers locally equivalent to $B\mathbb G_m$, band $\mathbb G_m$, and a class in $H^2_{\mathrm{fppf}}(J,\mathbb G_m)=\mathrm{Br}(J)$ obstructing a global universal line bundle. Choosing $r$ splits the gerbe:
    \[
    \mathbf{Pic}^0_{C/k} \simeq (B\mathbb G_m)\times J
    \]
    This splitting is noncanonical without a basepoint, but canonical once $r$ is fixed.
\end{remark}

The degree-zero restriction is easy to remove.
We denote by $J_d$ the set of isomorphism classes of line bundles of degree $d$
(so $J_0 = J$).
We can change the degree of any given line bundle on $R$ to zero
by twisting by a multiple of your favorite point, and we get:

\begin{proposition}
The group $\Pic(R)$ of isomorphism classes of holomorphic line bundles on $R$
fits into a short exact sequence
\[
1 \longrightarrow J \longrightarrow \Pic(R)
\stackrel{\deg}{\longrightarrow} \Z
\]
The sequence is split by a choice of point in $R$. However, the splitting does depend on the point.
\end{proposition}

For each degree $d \ge 0$, we have a holomorphic map
\[
AJ_d : \Sym^d R \longrightarrow J_d,
\]
defined by integrating the holomorphic differentials:
choose an auxiliary base point $r \in R$, and then send a divisor
$D \in \Sym^d R$ to the sum of integrals along a chosen collection of paths
from $r$ to the points of $D$.
A change of paths will change the integrals by an integral linear combination of periods,
so the map to $J_0$ is well defined;
now use the divisor $d\{r\}$ to identify $J_0$ with $J_d$,
and the resulting map to $J_d$ is now also independent of your choice of $r$. The image of the divisor $D$
is the isomorphism class of the line bundle $\mathcal{O}(D)$. In particular, the image of the Abel-Jacobi map is precisely the set of isomorphism classes of line bundles which admit a nontrivial holomorphic section
(i.e., those line bundles which can be represented as $\mathcal{O}(D)$ for some effective divisor $D$).

This map will hold the key to Riemann's solution of the multiplicative Cousin problem,
but we need to settle some of its properties first.
The word \textbf{generic} in the next theorem means
\textbf{away from an analytic subspace of strictly lower dimension}.
Analytic subspaces are locally cut out by a collection of holomorphic functions;
they are usually not submanifolds,
but they are always stratified by \textbf{locally closed} submanifolds of decreasing dimensions
(limiting their “badness”).

\begin{remark}
    [Identifing the differential of $AJ_d$] First we identify the tangent space of $J_d$ at a point $[L]$ representing a line bundle $L$ on $R$. Since $J_d \cong J_0 \cong H^0(R,K_R)^*/H_1(R,\Z)$, we have
\[T_{J_d,[L]} \cong H^0(R,K_R)^*.
\]
    
    Use the Abel-Jacobi map in holomorphic 1-form coordinates. Pick a basis $\{\omega_1,\dots,\omega_g\}$ of $H^0(R,K_R)$ and periods so that
    \[
    AJ_1(p)=\left(\int_{r_0}^p \omega_1,\dots,\int_{r_0}^p \omega_g\right)\in J
    \]
    For reduced $D=p_1+\cdots+p_d$, we have $AJ_d(D)=\sum_{i=1}^d AJ_1(p_i)$. Let $v=(v_1,\dots,v_d)\in \bigoplus_i T_{p_i}R$ be a tangent to $\Sym^dR$ at $D$. Vary $p_i(t)$ with $ p'_i(0)=v_i$. Then the derivative of an integral of a holomorphic form along a path with moving endpoint is just evaluation of the form at that endpoint against the velocity vector:
    \[
    \left.\frac{d}{dt}\right|_{t=0}\int_{r_0}^{p_i(t)}\omega_k=\omega_k(p_i)(v_i)
    \]
    Summing over $i$ gives the differential
    \[
    d(AJ_d)_D: \bigoplus_{i=1}^d T_{p_i}R \longrightarrow H^0(R,K_R)^*
    \]
    \[
    (v_1,\dots,v_d) \longmapsto \left(\omega \mapsto \sum_{i=1}^d \omega(p_i)(v_i)\right)
    \]
    The situation is more delicate if $D$ is not reduced. Choose a local coordinate $z$ near each $p_i$.
    Write $\omega = f(z)\,dz$, so $f(z)$ is holomorphic.

    A tangent vector to $\Sym^d R$ at $D$ corresponds to a choice of infinitesimal deformation of each $m_i p_i$, i.e. an element of $H^0(\mathcal O_R(D)|_D) \cong \bigoplus_i \mathbb C[z]/(z^{m_i})$. That means you specify the coefficients of $(1, z, z^2, \ldots, z^{m_i-1})$ at each $p_i$.

    Then the differential of the Abel-Jacobi map acts by:
    \[
    d(AJ_d)_D: \bigoplus_i \mathbb C[z]/(z^{m_i}) \longrightarrow H^0(K_R)^*
    \]
    \[
    (v_{i,0}, v_{i,1}, \ldots, v_{i,m_i-1})_i \mapsto \left(\omega \mapsto \sum_i \sum_{k=0}^{m_i-1} \frac{1}{k!}\, \omega^{(k)}(p_i)\, v_{i,k}\right)
    \]
    where $\omega^{(k)}(p_i)$ means the $k$-th derivative (the $k$-jet) of the local coefficient function $f(z)$ of $\omega=f(z)\,dz$.
    
    In general, there is a uniform way to describe the differential valid for all $D$:
The differential \[d(AJ_d)_D : H^0(\mathcal O_R(D)|_D) \to H^1(\mathcal O_R)\] is given by the connecting homomorphism in the long exact sequence \[0 \to \mathcal O_R \to \mathcal O_R(D) \to \mathcal O_R(D)|_D \to 0\]
\end{remark}

\begin{theorem}[Properties of the Abel-Jacobi map]
Let $AJ_d : \Sym^d(R) \to J_d$ be the Abel-Jacobi map which sends a degree $d$ effective divisor $D$ on $R$ to the isomorphism class of the line bundle $\mathcal{O}(D)$.
\begin{enumerate}[(i)]
\item The fiber of $AJ_d$ at a point $j \in J$ representing a line bundle $L$ on $R$
is isomorphic to the projective space $\mathbb{P}H^0(R;L)$.
(This is empty if $h^0(R;L)=0$.)
\item For $d \le g$, the map $AJ_d$ is generically injective,
and a local embedding in $J_d$.
\item For $d = g$, it is also surjective,
and therefore a generic isomorphism.
\item For $g \ge 2g - 1$, the map $AJ_d$ realizes $\Sym^d(R)$
as a holomorphic projective bundle over $J_d$.
\end{enumerate}
\end{theorem}

\begin{proof}
    \leavevmode
\begin{enumerate}
    \item A point in the fiber over $j$ is an effective divisor $D$ of degree $d$
such that $\mathcal{O}(D) \cong L$.
The set of such divisors is in bijection with the set of nonzero holomorphic sections
of $L$, modulo scaling,
which is precisely $\mathbb{P}H^0(R;L)$.
    \item The fibers are connected. Local injectivity/isomorphism can be checked by computing the differential of $AJ_d$ and checking that it is injective at generic points. The differential at $(p_1 + \cdots + p_d) \in \Sym^d R$ is given by the map \begin{align*}
    T_{p_1} R \oplus \cdots \oplus T_{p_d} R & \to T_{AJ_d(p_1 + \cdots + p_d)} J_d \cong H^0(R, K_R)^* \\
    (v_1, \ldots, v_d) & \mapsto \left( \omega \mapsto \sum_{i=1}^d \omega(v_i) \right) 
\end{align*} The map fails to be injective if and only if there exist nonzero $v_i \in T_{p_i} R$ such that \begin{align*}
    \sum_{i=1}^d \omega(v_i) & = 0
\end{align*} for all $\omega \in H^0(R, K_R)$. This is equivalent to saying that there exists a holomorphic differential $\omega$ vanishing at all $p_i$. By Riemann-Roch, for generic choices of $p_i$, there are no nontrivial holomorphic differentials vanishing at all $p_i$ if $d \leq g$. Hence, the differential is injective at generic points, making $AJ_d$ a local embedding.
\item The argument is the same as local injectivity.
\item By Riemann-Roch, for $d \geq 2g - 1$, we have \begin{align*}
    h^0(R, L) & = d - g + 1
\end{align*} for all line bundles $L$ of degree $d$ because $H^1(R, L) = 0$ by Serre duality. Therefore, the fibers of $AJ_d$ are all projective spaces of dimension $d - g$. This gives $\Sym^d(R)$ the structure of a holomorphic projective bundle over $J_d$.
\end{enumerate}
\end{proof}

\begin{remark}[Non-effective line bundles of nonnegative degree]\label{rmk:non-effective}

    The discussion of the Abel Jacobi map shows that for $g \geq 1$, there exist line bundles of degree $0 \leq d < g$ with no nontrivial holomorphic sections.

Consider the Abel-Jacobi map
\[
i_r:X\longrightarrow \Pic^0(X),\qquad s\longmapsto \mathcal{O}_X(s-r).
\]
Its image is a 1-dimensional subvariety of the $g$-dimensional torus $\Pic^0(X)$ and hence cannot be all of $\Pic^0(X)$.

Pick a degree-zero line bundle $T\in\Pic^0(X)$ not in $i_r(X)$.
Set
\[
L = \mathcal{O}_X(r)\otimes T \in \Pic^1(X).
\]
Then $\deg L=1$, but $h^0(X,L)=0$. This is because if $h^0(X,L)>0$ then $L\simeq \mathcal{O}_X(p)$ for some $p\in X$. Hence
$T \simeq L\otimes \mathcal{O}_X(-r) \simeq \mathcal{O}_X(p-r)$,
so $T\in i_r(X)$, contradicting the choice of $T$. Thus $L$ is a non-effective class of nonnegative degree.
More generally, for any $0\le d<g$, choose $T\in\Pic^0(X)\setminus (W_d - D_0)$ and set $L=\mathcal{O}_X(D_0)\otimes T$ with $\deg D_0=d$; then $h^0(X,L)=0$.




\end{remark}

Let $W_d \subset J_d$ denote the image of $AJ_d$.
They are only interesting for $d < g$,
and the most interesting one is $W_{g-1}$,
also known as the \textbf{theta-divisor}.

\begin{proposition}
    The points of $W_{g-1}$ correspond to
isomorphism classes of line bundles $L$ on $R$
with $h^0(R;L) \ge 1$. It has codimension $1$ and therefore generically smooth. The smooth points correspond to line bundles $L$ with $h^0(R;L) = 1$. Locally $W_{g-1}$ is given as the zero locus of a single holomorphic function (a theta function).
\end{proposition}

\begin{proof}
    The map $AJ_{g-1}$ has domain of dimension $g-1$ and target of dimension $g$ and is generically injective, so its image $W_{g-1}$ has dimension $g-1$, hence codimension $1$ in $J_{g-1}$. Its image is those line bundles which came from effective divisors of degree $g-1$. Such line bundles $L$ satisfy $h^0(R;L) \geq 1$ since they have a nontrivial holomorphic section given by the constant section $1$ in $\mathcal{O}_R(D)$ for some effective divisor $D$ with $\mathcal{O}_R(D) \cong L$. Explicitly (because I always get confused by this) there's a natural inclusion
\[\mathcal O_R \hookrightarrow \mathcal O_R(D),\qquad
f \longmapsto f\cdot 1\]
where the image of the constant function $1$ is a holomorphic section of $\mathcal{O}_R(D)$. 

Locally near $p_i$, pick a coordinate $z$ vanishing at $p_i$, and note that $\mathcal{O}_R(D)|_U \cong z^{-m_i}\mathcal{O}_U$. In this local trivialization, the "section 1" of $\mathcal{O}_R(D)$ corresponds to $z^{m_i}$ as a function. That function does vanish to order $m_i$ at $p_i$.

    By the implicit function theorem, the smooth points of $W_{g-1}$ correspond to points where the differential of $AJ_{g-1}$ is injective.

    The rank of the differential of $AJ_{g-1}$ controls the regularity of the image. From the differential computation, we have
    \[
    d(AJ_d)_D : \bigoplus_i T_{p_i}R \to H^0(K_R)^*, \quad (v_i) \mapsto (\omega\mapsto \sum_i\omega(p_i)(v_i))
    \]
    Its kernel is nontrivial if and only if there exists a nonzero $\omega\in H^0(K_R)$ such that $\omega(p_i)(v_i)=0$ for all $i$, i.e. $\omega$ vanishes at all $p_i$. Hence $\ker d(AJ_{g-1})_D \neq 0$ if and only if $H^0(K_R(-D))\neq 0$.

    By Riemann-Roch:
    \[
    h^0(K_R(-D)) = h^0(\mathcal{O}_R(D)) + (g-1) - g + 1 = h^0(\mathcal{O}_R(D))
    \]
    Thus $\ker d(AJ_{g-1})_D \neq 0$ if and only if $h^0(\mathcal{O}_R(D)) \geq 2$. In particular, if $h^0(\mathcal{O}_R(D)) = 1$, the differential is injective.

    General theory of complex analytic spaces tells us that a codimension $1$ analytic subspace is locally cut out by a single holomorphic function. In particular, every Weil divisor is locally principal, i.e. a Cartier divisor. However, we will see later that $W_{g-1}$ is actually globally principal, cut out by a theta function.
\end{proof}

\begin{definition}
    A \textbf{theta characteristic} on a Riemann surface $R$ is a line bundle $\rho$ satisfying \begin{align*}
        \rho^{\otimes 2} & \cong K_R
    \end{align*} where $K_R$ is the canonical bundle of $R$.
\end{definition}
If we pick a basepoint $p_0 \in R$ to identify $J$ with $J_{g-1}$, then the difference of two theta characteristics is a $2$-torsion point in $J$, i.e. a line bundle $\tau$ satisfying \begin{align*}
    \tau^{\otimes 2} & \cong \mathcal{O}_R
\end{align*} This is because if $\rho_1, \rho_2$ are two theta characteristics, then \begin{align*}
    (\rho_1 \otimes \rho_2^{-1})^{\otimes 2} & \cong K_R \otimes K_R^{-1} \cong \mathcal{O}_R
\end{align*} The set of $2$-torsion points in $J$ forms a group isomorphic to $(\Z/2\Z)^{2g}$, so there are $2^{2g}$ theta characteristics on $R$.

\begin{remark}
    [Cultural remark on theta characteristics] A square root of $K$ on a Riemann surface is the same as a spin structure on the tangent bundle. It is also given by a quadratic form on $H_1(R, \Z/2\Z)$ compatible with the intersection form, i.e. a function $q:H_1(R, \Z/2\Z) \to \Z/2\Z$ satisfying \begin{align*}
        q(a + b) & = q(a) + q(b) + a \cup b
    \end{align*} where $a \cup b$ is the intersection number modulo $2$. 
\end{remark}

The following theorem describes the symmetries of $W_{g-1}$. Translating $W_{g-1}$ by a theta characteristic corresponds to shifting the theta function by a half-period in the classical theory of theta functions.

\begin{theorem}
    \leavevmode
    \begin{enumerate}
        \item $W_{g-1}$ is invariant under the involution $L \mapsto K_R\otimes L^{-1}$ on $J_{g-1}$.
        \item (equivalent to (1)) Let $\rho$ be a theta characteristic, i.e. a line bundle satisfying $\rho^{\otimes 2} \cong K_R$. Then $\rho W_{g-1}$ is self-inverse under the group law on $J_0$
        \item $W_{g-1}$ is not invariant under any translation of the torus.
        \item $W_{g-1}$ is invariant under reflection by theta chraracteristics, but not under any reflections.
    \end{enumerate}
\end{theorem}

\begin{proof}
    
\end{proof}

\begin{remark}
    There exists a universal vector bundle (the Poincaré bundle) $\cP_d$ over $R \times J_d$ such that for any line bundle $L$ on $R$, there is a natural isomorphism \begin{align*}
        L & \cong \cP_d|_{R \times \{[L]\}}
    \end{align*} To make $\mathcal{P}_d$ unique, one must choose a base point $r\in R$ and require that $\mathcal{P}_d$ be trivial along $\{r\}\times J_d$:
    \[
    \mathcal{P}_d|_{\{r\}\times J_d} \cong \mathcal{O}_{J_d}
    \]
    Without this normalization, the universal line bundle is only defined up to tensoring by a line bundle pulled back from $J_d$.
    
    Taking $d=g-1$, we have finite dimensional holomorphic vector bundles on $J_{g-1}$ denoted $\cH_0$ and $\cH_1$, a holomorphic map $\mathrm{pp}:\cH_0 \to \cH_1$, and an exact sequence of vector spaces for every $j\in J_{g-1}$\begin{align*}
        0 \to H^0(R, L_j) & \to (\cH_0)_j \to (\cH_1)_j \to H^1(R, L_j) \to 0
\end{align*}
This map $\mathrm{pp}:\cH_0 \to \cH_1$ is the principal parts map, which at a point $j \in J_{g-1}$ representing a line bundle $L$ on $R$ is given by taking a global meromorphic section of $L$ and sending it to its principal parts at all points of $R$ (i.e its obstruction to being holomorphic). 
\end{remark}

Now we introduce an identification of the theta line bundle $\Theta$ on $J_{g-1}$ with the inverse determinant line bundle of the complex of vector bundles $\cH_0 \to \cH_1$.

\begin{theorem}
    $\Theta \cong \Lambda^{\mathrm{top}} \cH_1 \otimes (\Lambda^{\mathrm{top}} \cH_0)^{-1}$ where $\Theta$ is the line bundle on $J_{g-1}$ with divisor $W_{g-1}$. The map $\det \mathrm{pp}:\cH_0 \to \cH_1$ induces a holomorphic section of $\Theta$ whose zero locus is precisely $W_{g-1}$.
\end{theorem}

\begin{remark}
    [What $\cP_d$ is not]  Consider the map $R \times \Sym^d R \to J_{d-1}$ given by \begin{align*}
        (p, D) & \mapsto AJ_d(D) - AJ_1(p)
    \end{align*}  The universal line bundle $\cP_{d-1}$ on $R \times J_{d-1}$ can be pulled back to $R \times \Sym^d R$ along this map. This pullback gives a divisor called the incidence divisor \begin{align*}
        I & = \{(p, D) \in R \times \Sym^d R : p \in \operatorname{supp}(D) \}
    \end{align*} It turns out that this is not quite $(\id_R \times AJ_d)^* \cP_d$. Instead, we have an isomorphism of line bundles on $R \times \Sym^d R$ \begin{align*}
        \cO(I) & \cong (\id_R \times AJ_d)^* \cP_d \otimes \cO(1)
    \end{align*} where $\cO(1)$ is the hyperplane line bundle along the projective fibers of $\Sym^d R \to J_d$. More precisely, if we denote by $\pi:R \times \Sym^d R \to \Sym^d R$ the projection map, then \begin{align*}
        \cO(1) & = \pi^* \mathcal{O}_{\Sym^d R}(1)
    \end{align*} This discrepancy arises because the incidence divisor $I$ only keeps track of the points in the support of the divisor $D$, while the universal line bundle $\cP_d$ also encodes the tautological line on the projectivized space of sections
\end{remark}
\subsection{Riemann Theta function}
Recall that we had a basis of holomorphic differentials $\phi_1, \ldots, \phi_g$ on $R$ normalized so that the period matrix \begin{align*}
    \Omega & = [I | B]
\end{align*} with $B$ symmetric and $\Im B$ positive definite. Define the Riemann theta function \begin{align*}
    \theta(z | B) & = \sum_{n \in \Z^g} \exp\left( 2\pi i \left( \frac{1}{2} n^t B n + n^t z \right) \right)
\end{align*} where $z \in \C^g$. 

\begin{theorem}[Properties of the Riemann theta function]
\leavevmode
\begin{enumerate}[(1)]
    \item $\Theta$ converges uniformly on compact subsets.
    \item $\Theta$ is periodic under translations 
    \[
        \vec{z} \;\longmapsto\; \vec{z} + \vec{e}_j,
    \]
    and satisfies the quasi-periodicity relation
    \[
        \Theta(\vec{z} + B\vec{m}; B)
        =
        \Theta(\vec{z}\,|B)
        \exp\!\bigl(-2\pi i(\vec{m}'\vec{z} + \tfrac{1}{2}\vec{m}^\top B \vec{m})\bigr).
    \]
    \item The zero locus of $\Theta$ is the translate
    \[
        W_{g-1} - \rho,
    \]
    where $\rho$ is a theta characteristic determined by the choice of $a$ and $b$ cycles.
\end{enumerate}
\end{theorem}

\begin{proof}[Proof of (3)]
The evenness of $\Theta$ implies symmetry under half-lattice points.
We will see that:
\begin{itemize}
    \item Topologically, $\Theta \cong \mathcal{O}(W_{g-1})$.
    \item Holomorphic line bundles of this type are related by translation on $J$. In particular, two line bundles of the same topological type on $J$ differ only by a translation. This is a general theorem about line bundles on complex tori.
    \item Symmetry forces only half-lattice translations to be allowed.
\end{itemize}
\end{proof}


We are now prepared to solve the multiplicative Cousin problem on $R$. Consider the map
\[
F : R \times \Sym^g R \;\longrightarrow\; J_{g-1},
\qquad
(r,D) \longmapsto AJ(D) - AJ(r).
\]

\begin{claim}
\(F^{-1}(W_{g-1}^{\text{smooth}}) = \{\, (r,D) \mid r \in D \,\}.\)
\end{claim}

\begin{remark}
If \(\dim H^0(R, \mathcal{O}(D)) > 1,\)
then \(F^{-1}(AJ(D))\) projects surjectively onto all of \(R.\)
\end{remark}


Therefore the function $\Theta(F(r,D) + \rho)$ as a function of $r \in R$ has divisor exactly $D$. This implies that we can solve almost any prescription of zeros and poles by a ratio of products of shifted theta functions restricted to $AJ_1(R) \subset J$.

Abel's condition ensures we can arrange the shifts so that
the result is periodic with respect to the lattice,
hence we obtain a single valued \emph{meromorphic function on \(R\)}.

\begin{remark}
    Torelli's theorem states that a compact Riemann surface $R$ is determined up to isomorphism by its Jacobian $J(R)$ together with the theta divisor $W_{g-1} \subset J(R)$. In other words, if two compact Riemann surfaces have isomorphic Jacobians as principally polarized abelian varieties (i.e. the isomorphism identifies the theta divisors), then the Riemann surfaces themselves are isomorphic.
\end{remark}
\end{document}